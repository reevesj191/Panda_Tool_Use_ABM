---
title: Modelling a primate technological niche 
author:
  - name: Jonathan S Reeves
    affiliation: a
  - name: Tomos Proffitt
    affiliation: a
  - name: Lydia Luncz
    affiliation: a
address:
    
  - code: a
    address:  Max Planck Institute for Evolutionary Anthropology, Technological Primate Research Group, Deutscher Platz 6., Leipzig, Germany, 04103
corresponding_author:
  code: 2
  text: "E-mail: jonathan_reeves@eva.mpg.de"
lead_author_surname: Reeves
author_contributions: |
  Please provide details of author contributions here.
conflict_of_interest: |
  There are no conflicts of interest.
abstract: |
  
  Tool transport has been fundamental to the success of our lineage. The relocation of materials from where they naturally occur to where they are needed modifies the environment in a way that increases access to a broader landscape. In contrast, transport of tools over long distances has never been observed in primates. However, chimpanzee stone tools have been recorded farther from their raw material source than what is expected from ethological observations. The mechanisms through which the long distance relocation of tool material occurs is currently unknown. Here we present an agent-based model, built on observations of wild chimpanzee tool transport, that explores the relationship between tool-use, the environment, and the formation of the archaeological record. While our results show that primate tool-use is largely constrained by the environment, there are circumstances in which the aggregated effect of small-scale tool transport can dramatically increase the distribution of tool material across a wider landscape over time. This highlights the capacity for small-scale transport to increases the accessibility of otherwise inaccessible resources over time. Moreover, understanding the landscape patterning that this behavior produces will help us to draw corollaries between tool behavior and its archaeological record.  While our results also suggest that these processes leave tangible traces in the archaeological record, they are variable  and alerts us to the disparity between observed behaviors and their archaeological signature.
  
significance: |

 Primate tool-use is generally considered to be expedient and largely restricted to places where tool materials and resources occur in close proximity. Our model shows how the repeated transport of stone tools over short distances can expand where tool-use can occur beyond the natural landscape. These results demonstrate the capacity for chimpanzee technological behavior to modify environments over time. However, inferring this behavior from its material record may prove difficult given mismatches between the behavior and its archaeological signature. 
  
acknowledgements: |
  
  We  thank the Max Planck Institute for Evolutionary Anthropology for hosting our research group. JSR thanks the Luke Premo for providing feedback and thoughtful discussion on an earlier version of this work.   

keywords:
  - Tool Transport
  - Niche Construction
  - Percussive tools
  - Primate Archaeology
  - Agent-Based Modeling
## must be one of: pnasresearcharticle (usual two-column layout), pnasmathematics (one column layout), or pnasinvited (invited submissions only)
pnas_type: pnasresearcharticle
bibliography: pnas-sample.bib
csl: pnas.csl
lineno: false
output:
  pdf_document:
    
    rticles::pnas_article
  word_document: default
    
    
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}


library(data.table)
library(dplyr)
library(ggplot2)
library(gridExtra)
source("../ABM_Functions.R")

## Figure theme

base_theme <- theme(axis.text = element_text(size = 5),
                    axis.title = element_text(size = 6),
                    panel.background = element_rect(color = "black", fill = "white"))

## Load Data
run_data <- fread("../Data/EXP_PNAS_run_data.csv")

OGs <- fread("../Data/EXP_PNAS_All_OG.csv")
sources <- fread("../Data/EXP_PNAS_sources.csv")

OGs$d2source <- dist2source(tools = OGs,
                            sources = sources)

OGs <- left_join(OGs, run_data)
```

  The adaptive success of humans is largely based on the transport of tools to overcome environmental constraints. Over human evolutionary history, this trait has facilitated the expansion of humans and their ancestors across every environment in the terrestrial world [@hillEmergenceHumanUniqueness2009]. The onset of long distance transport in the Early Stone Age initiated the wider access to resources, allowing hominins to exploit a broader landscape [@pottsWhyOldowanPlioPleistocene1991]. This ability to modify the broader environment through the use and relocation of tool material is considered to be a hallmark of the human niche [@lalandNicheConstructionBiological2000; @haasForagerMobilityConstructed2019]. In contrast, stone tool transport in non-human primates is considered to be generally constrained by the environment as tool use only happens when tool materials and food resources occur in the same location and only transport over short distances has been observed [@koopsEcologyCultureEnvironmental2013; @visalberghiDistributionPotentialSuitable2009]. In the Tai Forest, Côte d'Ivoire, chimpanzee stone hammers have been recorded kilometers from their nearest raw material source [@lunczDistancedecayEffectStone2016]. However, it is not known whether this form of transport constitutes a modification of the environment that subsequently influences behaviors. Understanding the mechanisms by which chimpanzees move tools over long distances is important as it redistributes tool material. This, in turn, may influence tool-using opportunities providing access to resources across a broader landscape [@koopsEcologyCultureEnvironmental2013].
  
  Moreover, there is a growing consensus that primate like tool-use may have been the precursor to the current earliest physical evidence of tool-use and transport in the archaeological record of hominins [@pangerOlderOldowanRethinking2003]. However, there is little understanding of what this record may look like (but see @pangerOlderOldowanRethinking2003). Thus, understanding the broader dynamics of primate tool-use may help develop expectations for the archaeological signature of the early tool use hominins.
  
  Understanding how individual bouts of small scale tool-use produce landscape scale patterning and subsequently the formation of the archaeological record requires bridging multiple temporal gaps [@stinerChallengesDocumentingCoevolution2020].  Daily observations of extant primate stone tool use reflect individual behavior, whereas their landscape scale material record likely represents the aggregation of many tool-using events of over multiple years [@lunczDistancedecayEffectStone2016]. Furthermore, the earliest archaeological record often reflects hundreds if not thousands of years of time [@sternImplicationsTimeaveragingReconstructing1994]. As a result, neither the development of landscape wide patterns of wild primate tool-use nor the subsequent formation of the archaeological record can be directly observed. 
  
  Behavioral processes such as transport, re-use, and use-life are known to have a substantial influence on the patterning of the archaeological record [@schifferFormationProcessesArchaeological1987]. This is particularly pertinent to primate tool-use as some groups repeatedly re-use the same tools over time [@boeschMentalMapWild1984]. The dynamic movement and reuse of stone tools over time is argued to lead an underrepresentation of percussive technology in the chimpanzee archaeological record [@proffittRevisitingPanda1002018]. Despite the fact that Chimpanzees were frequently observed to crack nuts with large stone hammers, no complete hammerstones were recovered from archaeological contexts [@proffittRevisitingPanda1002018]. Therefore, understanding the relationship between primate tool-use, the broader landscape, and its archaeological corollaries requires methods that examine the development of patterns across multiple temporal scales. 

  Here we present an agent-based model (ABM) that is designed to bridge the gaps between the various temporal disconnects between individual behaviors, environmental process, and the formation of the archaeological record. To investigate the effect of primate tool-use on the broader distribution of tool materials, we model small scale tool transport and use, akin to chimpanzee nut-cracking. We varied the number of resources – sources of stone and tool-use locations - to further understand the environmental circumstances in which the movement of tools over long distances occur. In doing so, we are also able to examine the effect of tool transport on the future opportunities for tool-use and the accessibility of resources over time as well as how such dynamics structure the formation of the archaeological record. 

Materials and Methods
======================

  The model was designed and implemented using Python 3 and the ABM library Mesa [@masadMESAAgentBasedModeling2015]. The model consists of a 250 x 250 grid-cell space that is populated with four types of agents; _Primates_, _Sources_, _Trees_, and _Pounding Tools_.  This grid space can be thought of as a forest in which agents move across the landscape, transporting stone tools over small distances as they encounter resources that require tool use to access. The tool-use behavior implemented in the model, is designed to approximate Panda nut cracking of Western Chimpanzees [@boeschWildCulturesComparison2014]. _Primates_ are agents that can be thought of as chimpanzees who move around the landscape cracking nuts at any opportunity. _Sources_ are stationary agents whose locations reflect places where _Pounding Tools_ can be acquired (e.g. inselburgs and cobble beds).  _Sources_ can vary in their “quality” which determines how likely _Pounding Tools_ are to break and lose mass during use.
  
  _Pounding Tools_ are analogous to the hammers used to crack nuts. _Pounding Tools_ vary in their mass (grams) and “quality”. The size of the Pounding Tool is determined by randomly drawing from a normal distribution with mean and standard distribution equivalent to the mass of the stone hammers recovered in the Tai Forest [@lunczDistancedecayEffectStone2016]. Quality refers to the likelihood a tool will break during use and subsequently lose mass and is determined by the “quality” of the _Source_ it is acquired from. _Pounding Tools_ can be continuously re-used until they break so much that they are too small (less than 2000 grams) to be used as tools. This size threshold is equivalent to a small Panda nut cracking hammer in the Tai Forest [@lunczDistancedecayEffectStone2016].  


  _Trees_ are agents that represent locations where tool use can occur. While _Trees_ exist only at fixed locations, the death and regrowth of trees within a forest can restructure where the resources are accessible over time [@pangerOlderOldowanRethinking2003]. To simulate this process, _Trees_ increase in age by a unit of 1 after each time-step and will die when their age is equal to 10,000 time steps. When a _Tree’s_ age reaches 10,000 time-steps nut-cracking can no longer take place at its location and a new location within a 10 grid-cell radius is randomly chosen as a place for a new _Tree_ to “grow.” Though the death and growth of _Trees_ are not linked in this way in the natural world, this ensures that the number of _Trees_ remains constant during the simulation.

  When the model is initialized, _Trees_, _Sources_, and _Primates_ are randomly placed within the grid-cell space. Each _Source_ is randomly assigned an integer of 0, 25, 50, or 75 representing raw material quality. To prevent every _Tree_ from dying at the same time-step, each _Tree_ is randomly assigned an age between 1 and 10000. _Trees_ that grow after model initialized begin with an age 0. The population of _Primates_ was held constant at 100 for each run of the model. The number of _Sources_ range between 10, 100, 500. The number of _Trees_ varied between 100, 500, 1000, or 2000.  The duration of each model run was 75,000 time steps.  

  During each time-step, _Primates_ move a length of 1 grid-cell in a random direction. If the _Primate_ moves into a grid-cell that neighbors or is occupied by a _Tree_, the _Primate_ will check to see if a _Source_ or _Pounding Tool_ is within a radius 2 grid-cells around its location. If there is none, then the _Primate_ continues to move. If a _Source_ is within the search radius of the _Primate_, then the _Primate_ will acquire a _Pounding Tool_ from this location. If a previously used _Pounding Tool_ is found within the search area, then the _Primate_ will re-use the _Pounding Tool_. In the event that both _Sources_ and _Pounding Tools_ are found within the search radius then the _Primate_ will choose the _Pounding Tool_ or _Source_ that is nearest to its location. If multiple _Pounding Tools_ or _Sources_ are equally near, then the choice is random.
	
  To simulate small scale tool transport and use, the _Primate_ moves the acquired _Pounding Tool_ to the location of the _Tree_ or one of its neighboring grid-cells where it is used and discarded. The likelihood that a _Pounding Tool_ will break is determined by a baseline probability of 25% plus its fragility. For example, if the fragility of the raw material is 25, this is added to the baseline making the break probability for this tool 50%. When a _Pounding Tool_ breaks, an additional _Pounding Tool_, classified as a fragment, is discarded at the location. The size of the resulting “fragment” is modeled after the observed size distribution of fragments detached from _Pounding Tools_ during modern and ancient chimpanzee nut-cracking events in which most breakages result in the production of small fragments but in rare cases fragments can also be large [@proffittRevisitingPanda1002018].   

```{r Stats SOM Table 1, include=FALSE}

n_runs_no_tool_use <- nrow(run_data[run_data$n_trees_available_start == 0,])
per_runs_no_tool_use <- round(n_runs_no_tool_use/nrow(run_data) * 100)

res <- anova(lm(run_data$n_trees_available_start~run_data$num_nutree + run_data$num_sources))
res_F_trees <- round(res$`F value`[1], 2)
res_F_sources <- res$`F value`[2]
res_P_trees <- res$`Pr(>F)`[1]


OGs_sum <- OGs %>% group_by(run_id, rm_quality) %>%
  summarize(max_d2_source = max(d2source))
OGs_sum <- left_join(OGs_sum, run_data)

n_maxD_greater_than_three <- sum(OGs_sum$max_d2_source > 3)
per_maxD_greater_than_three <- round(n_maxD_greater_than_three/nrow(OGs_sum) * 100)
max_d <- round(max(OGs_sum$max_d2_source))
run_data$new_trees <- run_data$n_trees_available_end - run_data$n_trees_available_start
n_runs_new_trees <- sum(run_data$new_trees > 0)
per_runs_new_trees <- round(n_runs_new_trees/nrow(run_data),2) * 100
```

  During the simulation, the model records data about the broader environment as well as each individual _Pounding Tool_. At the global level, the model monitors proximity of live _Trees_ to unexhausted _Pounding Tools_ and _Sources_. In iterations where _Trees_ can die and grow the model also keeps track of the location of the _Trees_ as they change through time. In addition, each _Pounding Tool_ records the _Source_ that it originated from, the number of times it was used for nut-cracking, its initial size and its size after use as well as its location at the end the simulation. At the end of the simulation the model outputs the location of each _Pounding Tool_ and any discarded fragments, _Sources_, and _Trees_ as well as their attributes. This provides a means to examine the relationship between where tool-use occurs and the location of _Sources_ and _Trees_ from both systemic and archaeological perspectives.

Results
========

### Environment-Tool Use Dynamics


```{r figure 1, echo=FALSE, fig.height=2.5, fig.width=3.25, fig.cap= "A two-way interaction plot illustrating the effect of the number of _Trees_ and number of _Sources_ on distance maximum distance _Pounding Tools_ move from its source. The number of sources has a marginal effect on the maximum distances _Pounding Tools_ move in the model whereas, increasing the number of _Trees_ has a large positive effect. \\label{d2source}" }

model.res <- lm(max_d2_source~num_nutree*num_sources, data = OGs_sum[OGs_sum$treessdie == 0,])

xp1 = seq(from=min(OGs_sum$num_nutree), to = max(OGs_sum$num_nutree), length.out = 11)
yp2 = seq(from=min(OGs_sum$num_sources), to = max(OGs_sum$num_sources), length.out = 11)
coeffs=coefficients(model.res)
pred.mat <- outer(X=xp1, Y = yp2, FUN =function(x,y){
  coeffs[1] + coeffs[1]*x+coeffs[2]*y + coeffs[3] *x*y
})

par(mar=c(0.2, 1.5, 0.2, 0.2))

tmat=persp(x=xp1,
           y= yp2,
           z=pred.mat,
           theta = -65,
           phi = 10, 
           expand = .5,
           r = 10, 
           xlab = "N Trees",
           ylab = "N Sources",
           zlab = "Max Dist from Source",
           ylim = range(yp2))


# model.res <- lm(new_trees~num_nutree*num_sources, data = run_data[run_data$treessdie == 0,])

# xp1 = seq(from=min(run_data$num_nutree), to = max(run_data$num_nutree), length.out = 11)
# yp2 = seq(from=min(run_data$num_sources), to = max(run_data$num_sources), length.out = 11)
# coeffs=coefficients(model.res)
# pred.mat <- outer(X=xp1, Y = yp2, FUN =function(x,y){
#   coeffs[1] + coeffs[1]*x+coeffs[2]*y + coeffs[3] *x*y
# })
# 
# tmat=persp(x=xp1,
#            y= yp2,
#            z=pred.mat,
#            theta = 135,
#            phi = 10, 
#            expand = .5,
#            r = 10, 
#            xlab = "N Trees",
#            ylab = "N Sources",
#            zlab = "N new opportunities",
#            ylim = range(yp2))

```

 At the beginning of each model run tool-use can only occur in places where a _Tree_ is a maximum distance of 3 grid cells from a _Source_.  Simply increasing both the number of _Sources_ and/or _Trees_ increases the number of places where tool-use is possible (SOM Figure 1: left, ANOVA, F: 2435.41, P-value: 0). Tool-use occurred at _Trees_ located more than 3 grid cells from the nearest source in 95% of the runs. When a _Pounding Tool_ is moved from a _Source_, it becomes a secondary source of material for other _Trees_. Provided _Trees_ are within three grid cells, tools can be moved between them. As a result, repeated small scale transport can incrementally move _Pounding Tools_ up to a maximum distance of 58 grid cells from their original _Sources_.  Consequently, this redistribution of tools increases the number of opportunities for tool-use across a wider landscape. At the end of 88% of all runs, there are more places where tool-use can occur than at the beginning (Figure \ref{d2source}). The runs that did not show an increase in tool-use opportunities are those where the number of _Trees_ are initially low (SOM Table 3).

  The results of the model show how opportunities for tool-use are impacted by the structure of the environment. _Pounding Tools_ move greater maximum distances when the number of _Trees_ increases (Figure \ref{d2source}, left). The frequency that _Pounding Tools_ can be transported and used is regulated by their size and quality. However, the relatively small size of detached fragments allows Pounding Tools to be utilized 35s to 400s of times prior to exhaustion. While higher quality materials move greater maximum distances (SOM Figure: XX), the potentially long use-life of _Pounding Tools_ result in a similar spatial distribution regardless of quality.  

  The interplay between changing _Tree_ locations and the extended use-life of _Pounding Tools_ further facilitates the incremental distribution of tool materials across the landscape. When the numbers of _Sources_ and _Trees_ are held constant, iterations where _Trees_ change their location (i.e life-cycle) increases the distance _Pounding Tools_ can move. When _Tree_ locations remains static, the number of opportunities for tool use, over time, eventually plateaus and no more loci become available (Figure \ref{tree_death}, top). Conversely, when _Tree_ locations are dynamic, opportunities for tool use does not plateau or diminish over time. Instead, the number of Trees where tool use is possible continues to increase (Figure \ref{tree_death}, right) despite the fact that _Pounding Tool_ transport and _Tree_ life cycles operate on different temporal scales.

```{r figure 2,dev= 'png', dpi= 1000 ,fig.height=3, fig.width=5, message=FALSE, warning=FALSE, include=FALSE}


env_data <- fread("../Data/EXP_PNAS_Env_Data_ns_500_nt_2000.csv")

for(id in unique(env_data$run_id)){
  n <- nrow(env_data[env_data$run_id == id,])
  env_data$ts[env_data$run_id == id] <- c(0:(n-1))
}

env_data <- subset(env_data, !(ts %in% c(0)))

env_data <- left_join(env_data, run_data)

static <- subset(env_data, treessdie == 0)
dynamic <- subset(env_data, treessdie == 1)

brks <- as.vector(quantile(dynamic$trees_available))

a <- ggplot(data = static, aes(ts, y=run_id)) + geom_tile(aes(fill = as.numeric(trees_available))) +
  labs(y = "iteration")+
  base_theme + 
  scale_fill_viridis_c(breaks= brks, labels = brks) + labs(x = "Time Step", fill = "N Tool-use locations")
  

b <- ggplot(data = dynamic, aes(ts, y=run_id)) + geom_tile(aes(fill = as.numeric(trees_available))) + 
  labs(y = "iteration")+
  base_theme +
  scale_fill_viridis_c(breaks= brks) + labs(x = "Time Step") 

c <- ggplot(static, aes(x = ts, y = as.numeric(trees_available))) +
  geom_path(aes(group = run_id), alpha = .5) +
  scale_y_continuous(limits = c(500,max(env_data$trees_available)))+
  labs(x = "Time", y = "Number of Trees Available")+
  base_theme

d <- ggplot(dynamic, aes(x = ts, y = as.numeric(trees_available))) +
  geom_path(aes(group = run_id), alpha = .5) +
  scale_y_continuous(limits = c(500,max(env_data$trees_available)))+
  labs(x = "Time", y = "Number of Trees Available")+
  base_theme

g_legend<-function(a.gplot){
  tmp <- ggplot_gtable(ggplot_build(a.gplot))
  leg <- which(sapply(tmp$grobs, function(x) x$name) == "guide-box")
  legend <- tmp$grobs[[leg]]
  return(legend)}

mylegend <- g_legend(a + theme(legend.direction = "horizontal", 
                               legend.title = element_text(size = 8),
                               legend.text = element_text(size = 6),
                               legend.background = element_blank()))


layout <- rbind(c(1,1,1,2),
                c(1,1,1,2))

arrange

grid.arrange(arrangeGrob(a + theme(legend.pos = "none", axis.text.y = element_blank()),c, layout_matrix = layout),
             arrangeGrob(b + theme(legend.pos = "none", axis.text.y = element_blank()),d, layout_matrix = layout),
             mylegend, nrow = 3, heights=c(10, 10, 2.5))

```


\begin{figure*}

\includegraphics[width=6.5in]{Reeves_et_al_2021_Panda_ABM_files/figure-latex/figure 2-1.png}

\caption{Time series plots illustrating the changes in the number of tool-use locations over time when _Trees_ are static (Top) and when they are dynamic (Bottom) for runs where the number of soures is 500 and the number of trees is 2000. The ticks on the y-axes of the color plots to the left represent individual interations of the model. The x-axis represents the time step in the model run. Therefore, any individual cell of color represents the number of locations where tool-use is possible. (Right) Each line represents an individual iteration of model with time represented on the x-axis and the number of tool-use locations is represented on the y-axis. Note that in iterations where _Tree_ locations is dynamic the number of tool-use locations is always greater. The slope of the lines ( Bottom right) show that the number of tool-using locations will continue to incrementally increase instead of plateauing.}

\label{tree_death}

\end{figure*}


### Material Signature

  The modeled behavior creates a material record that is comprised predominantly of fragments detached from _Pounding Tools_, but also exhausted and functional Pounding Tools in substantially smaller quantities. The spatial distribution, density and composition of the material record is dependent on the environmental circumstances that facilitate the movement of _Pounding Tools_. When _Trees_ are infrequent, the resulting assemblages form localized patches in the grid-cells nearest to _Sources_ (Figure \ref{distribution}, left). As the number of Trees increases, the material record becomes more wide-spread (Figure \ref{distribution}, middle). _Tree_ life cycles have the greatest effect on the distribution of the archaeological record across space (Figure \ref{distribution}, right). These results show that small scale transport, tool-use, coupled with varying resource densities and environmental stability can substantially influence the structure of the archaeological record.
  
```{r figure 3, fig.height=3.5, fig.width=7, message=FALSE, warning=FALSE, include=FALSE}

maptheme <- base_theme + theme(axis.title = element_blank(),
                               axis.text = element_blank(),
                               axis.ticks = element_blank())

xsources <- fread("../Data/Figure_3/Plot_A_sources.csv")
xtrees <- fread("../Data/Figure_3/Plot_A_trees.csv")
xtools <- fread("../Data/Figure_3/Plot_A_tools.csv")
xtools <- xtools %>% group_by(x,y) %>% summarise(N_tools = n())

xsources$type = "Stone source"

a <- ggplot() +
    geom_point(data = xtools, aes(x = x, y = y),size = .5)+
    geom_point(data = xsources, aes(x = x, y = y), color = "grey", size = 1)+
  coord_equal()+ 
  scale_x_continuous(limits = c(0,250)) +
scale_y_continuous(limits = c(0,250)) + 
  ggtitle("A")+
  maptheme + theme(legend.position = "none")
  

xsources <- fread("../Data/Figure_3/Plot_b_sources.csv")
xtrees <- fread("../Data/Figure_3/Plot_b_trees.csv")
xtools <- fread("../Data/Figure_3/Plot_b_tools.csv")
xtools <- xtools %>% group_by(x,y) %>% summarise(N_tools = n())

xsources$type = "Stone source"

b <- ggplot() +
    geom_raster(data = xtools, aes(x = x, y = y, fill = N_tools))+
    geom_point(data = xsources, aes(x = x, y = y), color = "grey", size = 1)+
  coord_equal()+ 
  scale_x_continuous(limits = c(0,250)) +
  scale_y_continuous(limits = c(0,250)) +
  ggtitle("B")+
  maptheme +  theme(legend.position = "none")


xsources <- fread("../Data/Figure_3/Plot_c_sources.csv")
xtrees <- fread("../Data/Figure_3/Plot_c_trees.csv")
xtools <- fread("../Data/Figure_3/Plot_c_tools.csv")
xtools <- xtools %>% group_by(x,y) %>% summarise(N_tools = n())

xsources$type = "Stone source"

c <- ggplot() +
    geom_raster(data = xtools, aes(x = x, y = y, fill = N_tools))+
    geom_point(data = xsources, aes(x = x, y = y), color = "grey", size = 1)+
  coord_equal()+ 
  scale_x_continuous(limits = c(0,250)) +
scale_y_continuous(limits = c(0,250)) +
  ggtitle("C")+
  maptheme + 
  theme(legend.position = "none")

xsources$type = " "

leg <- ggplot() +
    geom_raster(data = xtools, aes(x = x, y = y, fill = N_tools))+
    geom_point(data = xsources, aes(x = x, y = y, color = type), size = 1)+
  coord_equal()+ 
  scale_x_continuous(limits = c(0,250)) +
scale_y_continuous(limits = c(0,250)) +
  scale_color_manual(values = "Grey")+
  ggtitle("C")+
    labs(fill = "Number of Tools", color = "Stone Source")+
  maptheme + 
  theme(legend.position = "top")

leg <- ggpubr::get_legend(leg)


lay <- rbind(c(1,1,2,2,3,3),
             c(1,1,2,2,3,3),
             c(4,4,4,4,4,4))

grid.arrange(a,b,c,leg,
             layout_matrix = lay)

```

\begin{figure*}

\includegraphics[width=6.5in]{Reeves_et_al_2021_Panda_ABM_files/figure-latex/figure 3-1.pdf}

\caption{A: The archaeological record when there are 100 _Sources_ and 100 _Trees_. Note that the subsequent archaeological record forms extremely localized patches of material. B: The archaeological record there 100 sources and 2000 trees. This archaeological record is becoming more wide-spread but remains localized. C: The archaeological record there 100 sources and 2000 trees where trees can die and regrow. The notice how the the growth and death of trees becomes substantially more widespread.}

\label{distribution}

\end{figure*}

The total amount of discarded material per grid cell, the number of _Pounding Tools_ and the mass of _Pounding Tools_ form a distance-decay pattern in which these variables are negatively correlated with the distance to Source locations (Figures \ref{assemblages}, SOM Figure 5). The wide range of variance in these metrics in locations closer to _Sources_ is also due to the local configuration of Trees. If the location of Trees does not facilitate _Pounding Tool_ movement then the associated will only occur within the grid cells closest to the Sources (Figures \ref{assemblages}, SOM Fig. 6, SOM Fig. 7).  It is important to note that while this behavior can produce a widespread material record, _Pounding Tools_ are not found in every grid-cell that accumulates an assemblage. Environmental circumstances that promote the movement of _Pounding Tools_ across space (i.e numbers of _Trees_ or dynamic _Tree_ locations) have a negative effect on the proportion of grid-cells that contain re-usable tools (Figure \ref{pounding_tools}). In cases, where tools can move large distances, assemblages with _Pounding Tools_ comprise as little as 2.5% of the broader material record. This suggests there maybe some material records where usable _Pounding Tools_ are not easily recovered.

```{r figure 4, dev='png', dpi= 1000, fig.height=2.5, fig.width=6, include=FALSE}

tools <- fread("../Data/EXP_PNAS_tools_ns_100_nt_2000.csv")
trees <- fread("../Data/EXP_PNAS_trees.csv")
tools <- left_join(tools, run_data)
tools <- subset(tools, treessdie == 1)
tools$d2source <- dist2source(tools = tools,sources = sources) 
  
tools_sum <- tools %>% 
  group_by(run_id, x, y) %>%
  summarise(n_tools = n(),
            min_d2_source = min(d2source),
            n_pounding = sum(Tool_size >=2000))

tools_sum <- left_join(tools_sum, run_data)

a <- ggplot(tools_sum, aes(x = min_d2_source, y= n_tools)) + 
  geom_point() + 
  labs(x = "Minimum Distance to Source",
       y = "Number of artifacts") + 
  base_theme

b <- ggplot(tools_sum, aes(x = min_d2_source, y = n_pounding)) + geom_point() + 
    labs(x = "Minimum Distance to Source",
       y = "Number of Pounding Tools") + 
  base_theme


OGS_sub <- subset(OGs, treessdie == 1)

c <- ggplot(OGS_sub, aes(x = d2source, y=Tool_size)) + geom_point() + 
  labs(x = "Distance to Source",
       y = "Pounding Tool Size") + 
  base_theme

grid.arrange(a,b,c, ncol=3)


```

Discussion
=============

  The model illustrates the dynamic relationship between small scale tool-use and transport, the environment, and the formation of the archaeological record.  Agents only engaged in tool use during chance encounters where tool material could be moved short distances to tool using locations.  Though these results show that resources ultimately dictate the opportunities for tool use, in some circumstances, the aggregate effect of this behavior led to the widespread redistribution of tool material across the landscape. Repeated small scale tool transport has the power to move beyond the constraints of the natural environment to increase the number of opportunities for tool use at future time-steps.  Moreover, this process can work in tandem with the changing distribution of tool use localities over time to further increase the spread of tool material across the landscape. As a result, the landscape that agents inhabit at time step 0 is different to the one they inhabit at time step 75000.   
	
\begin{figure*}

\includegraphics[width=6.5in]{Reeves_et_al_2021_Panda_ABM_files/figure-latex/figure 4-1.png}

\caption{Left: A scatter plot showing the relationship between the number of artifacts (e.g. Pounding Tools and fragments) present within a grid-cell and its distance to the nearest source. Grid-cells closer to sources can possess a wider range of artifacts, whereas grid-cells farther from the source consistently possess few artifacts. Middle: Scatter plot showing the relationship of the number Pounding Tools in a grid cell with the distance to the nearest source. Right: The relationship between Pounding Tool size and distance to its source. Note: All plots show runs where the number of sources is 100 and the number of trees is 2000. See SOM figures 5, 6, and 7 for other model runs.}

\label{assemblages}

\end{figure*}

  Within primate populations, it has been argued that patterns of tool assisted foraging are largely constrained by encounter rates with resources [@carvalhoToolcompositeReuseWild2009; @koopsEcologyCultureEnvironmental2013]. It has been suggested that long distance movements of tools must occur on rare occasions [@whitenArchaeologyMeetsPrimate2013] or that the repeat short term transport of tools can result the movement of tools over long distances (McGrew 1992). This, however, has never been observed [@lunczDistancedecayEffectStone2016]. Here, our model shows that single long distance tool transport events are not needed to distribute percussive tools across the wider landscape. The aggregate effect of this behavior can increase the number of tool use opportunities over time and space. This illustrates the niche constructing capacity of primate tool using behaviors. The widespread distribution of pounding tools facilitated by their long use-lives generates feedback in which future generations inherit a landscape where opportunities for tool use are greater than they were before. More opportunities for tool-use increases the potential for the acquisition of tool using skills [@koopsEcologyCultureEnvironmental2013; @visalberghiDistributionPotentialSuitable2009; ]. Therefore, small scale tool transport produces a landscape which may ensure the continuation of tool behaviors across generations.

```{r figure 5, echo=FALSE, fig.height=2.25, fig.width=3.5, fig.cap= "The effect of the environment on the representation of _Pounding tools_ in the simulated material record. Increasing the number of sources increases the percentage of assemblages that contain _Pounding Tools_. Increasing the number of _Trees_ or allowing the _Tree_ locations to be dynamic substantially reduces the proportion of assemblages that contain useable tools \\label{pounding_tools}"}

run_tools_sum <- fread("../Data/EXP_PNAS_run_tools_sum.csv")

key <- c("Static Trees", "Dynamic Trees")
names(key) <- c(0,1)

ggplot(run_tools_sum, aes(x = as.factor(num_nutree),
                          y = per_site_pounding, 
                          fill = as.factor(num_sources))) + 
  geom_boxplot()+facet_wrap(~treessdie, labeller = labeller(treessdie = key)) + 
  scale_fill_brewer(palette = "Greys")+
  labs(x = "Number of Trees", y = "% of Sites with Pounding Tools", fill = "N Sources")+
  base_theme +
  theme(legend.position = c(.9,.65),
        legend.title = element_text(size = 8),
        legend.text = element_text(size = 6),
        legend.background = element_blank())

```
  
  In this light, the results of the model provide a context for exploring how primates modify their landscape beyond the scope of ethological observations. In the Tai Forest, hammerstones have been recorded up to 2 kilometers from the nearest raw material source [@lunczDistancedecayEffectStone2016]. Furthermore, the distribution of the size and wear of these hammerstones is consistent with the distance-decay relationship described in the model [@lunczDistancedecayEffectStone2016]. Although short distance transport of tools is observed in the Tai Forest, the broader spatial distribution is the end product of individual behaviors that remain undetected as they mostly happen in the absence of observers. This model illustrates the mechanism by which chimpanzees of the Tai Forest could emergently modify the distribution of tool materials across space through repeated re-use and transport of hammerstones. This may imply that, given that tool use is considered to be socially learned [@whitenCulturesChimpanzees1999], chimpanzees may increase their accessibility to resources through a culturally learned behavior. 

  The interaction between tool transport and the modeled environmental change could be applied to any resource that change location over time.  Beyond the implications for living primates, the model also illustrates how processes that operate on different temporal scales can interact to increase opportunities for tool use. In hominin evolutionary studies, one of the challenges of understanding the relationship between hominins and their environments through time is the need to link small scale behavioral processes with long term ecological dynamics [@iovitaOperationalizingNicheConstruction2021; @kingstonShiftingAdaptiveLandscapes2007; @stinerChallengesDocumentingCoevolution2020].  Few mechanisms that causally link local scale environmental change to behavior have, however, been purposed or identified [@behrensmeyerClimateChangeHuman2006]. Though the behavior of the agents in our model does not change over time, our model illustrate how processes that operate on different temporal scales (i.e. tool use life and environmental stability) can work in tandem to produce feedback that enhances opportunities for the behavior across space and time. Feedback loops such as the one described here may have influenced opportunities and access of resources to hominins prior to the advent of intentional long distance transport.

  The results of the model provide novel insights into the translation of dynamic behavior into the static archaeological record. The material records generated by the undirected forging strategies of the agents range from localized patches to structured distance decay-patterns. Both of these spatial patterns have been argued as evidence of intentional behavior reflecting planning, foresight, and land use strategies in the hominin record [@plummerFlakedStonesOld2004; @blumenschineEffectsDistanceStone2008]. Yet, we show that it is possible to produce both by solely varying the spatial distribution of resources without changing behavior. Our results emphasize the importance of the interplay between the environment and behavior in structuring the archaeological record [@brooksPreservationActivityAreas1987; @pangerOlderOldowanRethinking2003].  In the case of our model, a widespread material record can emerge as a consequence of the interaction between small scale tool transport, tool re-use, use-life, and resource distributions over time.  Understanding the mechanisms by which tools are moved and discarded become increasingly critical for interpreting the patterns described in the archaeological record.

Conclusion
===========

  Though small scale tool-use is ultimately constrained by its environment. This model shows that hammerstone transport  over time can have a significant effect  on the facilitation of tool behavior itself. The aggregate effect of short transportation events can improve the accessibility of resources within a landscape over time. This landscape pattern of unintentional tool provisioning not only potentially mitigates against local changes in the availability of resources but also increases the opportunity for nut cracking to be carried out. In this sense this tool-using behavior provides chimpanzees and potentially other tool-using non-human primates the capacity to positively modify their environments.. In the context of living Chimpanzee populations, the results of the model in combination with ethological data have the potential to incrementally modify their environments through a culturally learned behaviors.   

  In sum, small scale tool transport is ultimately constrained by the environment. However, our model illustrates how aggregate effect of short transportation events increases the accessibility of resources across a wider landscape over time. Furthermore, these results show that the modeled behavior can also interact with changes in landscape structure that further promote increases in the tool-use opportunities. This highlights the capacity for tool transport to emergently modify their environments over the long-term, thus, enhancing the technological niche across generations.

<!-- Leave these lines as they are at the end of your .Rmd file to ensure placement of methods & acknowledgements sections before the references-->

\showmatmethods
\showacknow
\pnasbreak

References
========== 


