---
title: On the Emergence of Culturally Constructed Landscapes
author:
  - name: Jonathan S Reeves
    affiliation: a
  - name: Tomos Proffitt
    affiliation: a
  - name: Lydia Luncz
    affiliation: a
address:
    
  - code: a
    address:  Max Planck Institute for Evolutionary Anthropology, Technological Primate Research Group, Deutscher Platz 6., Leipzig, Germany, 04103
corresponding_author:
  code: 2
  text: "E-mail: jonathan_reeves@eva.mpg.de"
lead_author_surname: Reeves
author_contributions: |
  Please provide details of author contributions here.
conflict_of_interest: |
  There are no conflicts of interest.
abstract: |
  
  Primates and humans represent two end members on the spectrum of tool using behaviors. On the primate side, while tool use provides access to otherwise inaccessible resources, opportunities for it are largely constrained by the distribution of resources and tool materials. On the other hand, tool use among humans represents the access to novel resources but a capacity to advantageously modify the surrounding environment on an unprecedented scale. Despite the assumed role of tools in shaping the evolutionary trajectory of the hominin clade, how the comparatively simple tool using behaviors observed in non-human primates became such a transformative trait in humans remains unclear. While behavioral ecological studies of chimpanzee tool use provide a window of insight into the root of tool use in the hominin lineage, placing these behaviors within a broader evolutionary context requires both linking these small scale behaviors are related to processes that operate on broader spatio-temporal scales as well as to a static archaeological record. Here we present an agent-based model that elucidates the long term dynamics between small-scale tool use, the environment, and the formation of the archaeological record. In doing so, we are able to show that while primate tool use is largely constrained by environmental parameters, there are circumstances in which such behaviors can positively modify their environments over the long term. While our results also suggest that these processes leave tangible corollaries in the archaeological record, they are variable and may be difficult to link back to the behaviors that produced them.
significance: |
 While primate behavioral ecological studies are argued to provide novel insight about hominin evolution, placing these insights within a broader evolutionary context is difficult. Our model demonstrates how agent-based modeling can be used to elucidate broader environment-tool use dynamics that may have been relevant to the evolution of tool use within the hominin lineage. 
acknowledgements: |
  We thank the Max Planck Institute for supporting this research.
keywords:
  - Tool Transport
  - Niche Construction
  - Percussive tools
  - Primate Archaeology
  - Agent-Based Modeling
## must be one of: pnasresearcharticle (usual two-column layout), pnasmathematics (one column layout), or pnasinvited (invited submissions only)
pnas_type: pnasresearcharticle
bibliography: pnas-sample.bib
csl: pnas.csl
lineno: false
output:
  word_document: default
    
    
  pdf_document:
    
    rticles::pnas_article
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}


library(data.table)
library(dplyr)
library(ggplot2)
library(gridExtra)

## Figure theme

base_theme <- theme(axis.text = element_text(size = 5),
                    axis.title = element_text(size = 6),
                    panel.background = element_rect(color = "black", fill = "white"))

## Load Data
run_data <- fread("../../Panda_ABM_Analysis/Data/EXP_12_Mem_Safe_Run_Data.csv")

OGs <- fread("../../Panda_ABM_Analysis/Data/EXP12_Mem_Safe_All_OG.csv")
sources <- fread("../../Panda_ABM_Analysis/Data/EXP12_MemSafe_All_sources.csv")
OGs <- left_join(OGs, run_data)
OGs_75k <- subset(OGs, n_time_steps == 75000)


sources$s_id <- paste(sources$run_id, sources$id)
OGs_75k$s_id <- paste(OGs_75k$run_id, OGs_75k$source_id)
source_join <- sources[,c("s_id", "x", "y")]
colnames(source_join) <- c("s_id", "s_x", "s_y")
OGs_75k <- left_join(OGs_75k, source_join, by = c("s_id" = "s_id"))
OGs_75k$d2source <- sqrt(((OGs_75k$x-OGs_75k$s_x)^2) + 
                           ((OGs_75k$y-OGs_75k$s_y)^2))

```

  The adaptive success of humans is largely based on our ability to use tools to mitigate or modify whatever environmental circumstances that confront us. Over human evolutionary history, this trait has facilitated the expansion of humans and their ancestors across every environment in the terrestrial world [@hillEmergenceHumanUniqueness2009]. While it is  now understood that the emergence of this trait is the result of feedback between genetic, ecological, and cultural processes over time [@boydNotGenesAlone2005; @danchinDNAIntegratingInclusive2011; @fogartyNicheConstructionCultural2017; @lalandCulturalNicheConstruction2011; @lalandNicheConstructionBiological2000; @obrienDualInheritanceCultural2017; @odling-smeeNicheConstructionTheory2013; @rendellRunawayCulturalNiche2011], the mechanisms that transformed this behavior from the simple forms of tool use that are observed across multiple taxa to an obligate reliance on material culture remains unclear. Primate behavioral ecology provides a potential window of insight into the origin of this trait as primate tool use is argued to approximate the types of tool using behaviors present at the root of the hominid lineage [@carvalhoToolcompositeReuseWild2009; @lalandAnimalCultures2008; @lunczPrimateArchaeologyReveals2015; @mcgrewChimpanzeeMaterialCulture1992]. Thus, examining the dynamic ecological settings in which tool-use occurs allows researchers to generate hypotheses of how complex tool use emerged and was maintained in the hominin lineage [@sanzEcologicalSocialCorrelates2013]. However, placing primate tool use within a broader evolutionary context requires (1) understanding its relationship within broader long term environmental dynamics and (2) establishing corollaries linking these dynamics to the variation in a recoverable material record [@pangerOlderOldowanRethinking2003; @stinerChallengesDocumentingCoevolution2020]. 

 For example, nut-cracking among chimpanzees is largely constrained by the environment. Nevertheless, some groups are argued to move stone tools potentially kilometers from where they are naturally found [@boeschMentalMapWild1984; @lunczDistancedecayEffectStone2016].  This slow redistribution of stone may influence the number of opportunities for tool use across a given landscape 10s of years. In addition, the location of nut-trees, which control the availability of nuts, change due to the death of old trees and growth of new ones over centuries. Therefore, understanding the relationship between small scale tool transport behaviors, the broader environment, and its effect on tool-use opportunities over time requires linking behavioral observations with processes that cannot be directly observed due to their temporal depth. Doing so, would not only provide unique insights into stone tool using behaviors among chimpanzees but also help to understand the relationship between tool-use, resource availability and environmental in the hominin record. This, in turn could be used as an framework for interpreting the hominin archaeological record.

 However, drawing connections between the archaeological record and ethological observations is not a simple task [@gifford-gonzalezBonesAreNot1991; @perreaultQualityArchaeologicalRecord2019]. Modern observations of primate stone tool use often reflect a handful of individual behavioral events, whereas the archaeological record reflects an aggregation of behavioral events over hundreds,potentially thousands of years [@baileyTimePerspectivesPalimpsests2007; @brooksPreservationActivityAreas1987; @schickModelingFormationEarly1987; @Stern1993; @sternImplicationsTimeaveragingReconstructing1994]. The aggregate pattern left in the material record may not directly reflect the individual behaviors that produced it [@lunczDistancedecayEffectStone2016; @rezekAggregatesFormationalEmergence2020; @schellingMicromotivesMacrobehaviors1978]. Behavioral processes such as transport, re-use, and use-life are known to have a substantial influence on the patterning of the archaeological record [@davidsonFinishedArtefactFallacy2002; @daviesModellingPalimpsestExploratory2016; @dibbleMajorFallaciesSurrounding2017; @frisonFunctionalAnalysisCertain1968; @schifferFormationProcessesArchaeological1987; @shottLowerPaleolithicIndustries2008]. The dynamic reuse and movement of nut-cracking hammers over time is argued to lead to the over representation of small fragments and general absence of complete percussive tools at chimpanzee archaeological sites [@proffittRevisitingPanda1002018]. 

  Here we present an Agent-based model (ABM) that is designed bridge the gaps between the various temporal and formational disconnects and individual behaviors, environmental process, and the formation of the archaeological record. To this end, we model small scale tool transport and use, akin to chimpanzee nut-cracking, within its broader environmental context to investigate the potential relationships between small scale tool using behavior, the environment, and the assemblage formation over time. In doing so, this work allows us to combine primate behavior with the environmental parameters that facilitate the generation and visibility of the archaeological record. 

Materials and Methods
======================

  The model was designed and implemented using Python 3 and the ABM library Mesa [@masadMESAAgentBasedModeling2015; @rossum1995python]. The model presented here can be thought of as a forest in which agents move across the landscape, transporting stone over small distances as they encounter resources that require tool use to access. As such, the model consists of a 250 x 250 grid-cell space that is populated with four types of agents; _Primates_, _Sources_, _Trees_, and _Pounding Tools_. _Primates_ are agents that can be thought of as chimpanzees who move around the landscape cracking nuts at any opportunity. _Sources_ are stationary agents whose locations reflect places where _Pounding Tools_ can be acquired (e.g. inselburgs and cobble beds). _Pounding Tool_ agents are analogous to the hammers used to crack nuts.  _Pounding Tools_ vary in their size and “quality”. The size of the _Pounding Tool_ is determined by randomly drawing from a normal distribution with mean and standard distribution equivalent to the mass of the stone hammers recovered in the Tai Forest [@lunczDistancedecayEffectStone2016]. The quality attribute determines how likely a _Pounding Tool_ is to break during use. _Pounding Tool_ quality is determined by the “quality” of the _Source_ it is acquired from.  _Pounding Tools_ can also become exhausted depending on how often they are used (see below).

_Trees_ are agents that represent locations where tool use can occur. While _Trees_ exist only at fixed locations, the death and regrowth of trees within a forest can restructure where the resources are accessible over time [@pangerOlderOldowanRethinking2003]. To simulate this process, _Trees_ increase in age by a unit of 1 after each time-step and will die when their age is equal to 10,000 time steps. When a _Tree’s_ age reaches 10,000 time-steps nut-cracking can no longer take place at its location and a new location within a 10 grid-cell radius is randomly chosen as a place for a new _Tree_ to “grow”. Though the death and growth of _Trees_ are not linked in this way in the natural world, this ensures that the number of _Trees_ remains constant during the simulation. 

When the model is initialized, _Trees_, _Sources_, and _Primates_ are randomly placed within the grid-cell space. Each _Source_ is randomly assigned an integer of 0, 25, 50, or 75 representing the likelihood to that acquired _Pounding Tools_ will break (quality). To prevent every _Tree_ from dying at the same time-step, each _Tree_ is randomly assigned an age between 1 and 10000. _Trees_ that grow after model initialized begin with an age 0. The population of _Primates_ was held constant at 100 for each run of the model. The number of _Sources_ range between 10, 100, 500. The number of _Trees_ varied between 100, 500, 1000, or 2000. We also varied whether _Trees_ could die and grow to examine the effect of a changing landscape over time. The effect of time on the availability of nut-cracking _Trees_ and the subsequent archaeological pattern was also investigated by varying the number of time-steps (25,000, 50,000, 75,000).  

  During each time-step, _Primates_ move a length of 1 grid-cell in a random direction. If the _Primate_ moves into a grid-cell that  neighbors or is occupied by a _Tree_, the _Primate_ will check to see if a _Source_ or _Pounding Tool_ is within a radius 2 grid-cells around its location. If there is none, then the _Primate_ continues to move. If a _Source_ is within the search radius of the _Primate_, then the _Primate_ will acquire a _Pounding Tool_ from this location. If a previously used _Pounding Tool_ is found within the search area, then the _Primate_ will re-use the _Pounding Tool_ for nut-cracking. In the event that both _Sources_ and _Pounding Tools_ are found within the search radius then the _Primate_ will choose the _Pounding Tool_ or _Source_ that is nearest to its location. If multiple _Pounding Tools_ or _Sources_ are equally near, then the choice is random. 
	
  To simulate small scale tool transport and use, the _Primate_ moves the acquired _Pounding Tool_ to the location of the _Tree_ or one of its neighboring grid-cells where it is used and discarded. Each time a _Pounding Tool_ is used there is a likelihood that it will break. The likelihood that a _Pounding Tool_ will break is determined by a baseline probability of 25% plus its raw material “quality”. For example, if the “quality” of the raw material is 25, this is added to the baseline making the break probability for this tool 50%. If a Pounding-Tool breaks then an additional _Pounding Tool_, representing the fragment, is generated and discarded at the location. The size of the resulting “fragment” is modeled after the observed size distribution of fragments detached from pounding tools during modern and ancient chimpanzee nut-cracking events in which most breakages result in the production of small fragments but in rare cases fragments can also be large [@proffittRevisitingPanda1002018]. This ensures that the production of small sized fragments is far more likely than the generation of a large sized fragment as is the case in chimpanzee nut-cracking activity [@proffittRevisitingPanda1002018]. Discarded hammer stones and fragments can continue to be re-used in subsequent nut-cracking events so long as they remain above size threshold of 2000 grams which is equivalent to a small Panda nut cracking hammer in the Tai Forest [@lunczDistancedecayEffectStone2016].     

  During the simulation, the model records data about the broader environment as well as each individual _Pounding Tool_. At the global level, the model monitors proximity of live _Trees_ to unexhausted Pounding-Tools and _Sources_. In iterations where _Trees_ can die and grow the model also keeps track of the location of the _Trees_ as they change through time. In addition, each Pounding-Tool records the _Source_ that it originated from, the number of times it was used for nut-cracking, its initial size and its size after use as well as its location at the end the simulation. At the end the simulation the model outputs the location of each Pounding-tool and any discarded fragments, _Sources_, and _Trees_ as well as their attributes. This provides a means to examine the relationship between where tool-use occurs and the location of _Sources_ and _Trees_ from both systemic and archaeological perspectives.

Results
========

### Environment-Tool Use Dynamics

```{r Stats SOM Table 1, include=FALSE}

n_runs_no_tool_use <- nrow(run_data[run_data$n_trees_available_start == 0,])
per_runs_no_tool_use <- round(n_runs_no_tool_use/nrow(run_data) * 100)

res <- anova(lm(run_data$n_trees_available_start~run_data$num_nutree + run_data$num_sources))
res_F_trees <- round(res$`F value`[1], 2)
res_F_sources <- res$`F value`[2]
res_P_trees <- res$`Pr(>F)`[1]


OGs_sum <- OGs_75k %>% group_by(run_id, rm_quality) %>%
  summarize(max_d2_source = max(d2source))
OGs_sum <- left_join(OGs_sum, run_data)

n_maxD_greater_than_three <- sum(OGs_sum$max_d2_source > 3)
per_maxD_greater_than_three <- round(n_maxD_greater_than_three/nrow(OGs_sum) * 100)
max_d <- round(max(OGs_sum$max_d2_source))
run_data$new_trees <- run_data$n_trees_available_end - run_data$n_trees_available_start
n_runs_new_trees <- sum(run_data$new_trees > 0)
per_runs_new_trees <- round(n_runs_new_trees/nrow(run_data),2) * 100
```


```{r figure-1, echo=FALSE, warning=FALSE, fig.cap=" **Left**: The effects of small scale tool use on the distance _Pounding Tools_ move from their source. The box plots show that the number of sources has a marginal effect on how far tools move from their source. However, fig.width=3.5, message=FALSE, warning=FALSE, paged.print=FALSE, the number of of Trees has positive influence on how far tools can move. **Right**: The effect of small scale tool use on the number of _Trees_ where tools use can occur. Both the number of _Sources_ and _Trees_ has a positive influence on the number of _Trees_ where tool use can occur. Note that the Y axis for the right panel is in log scale \\label{d2source}", fig.height=2.5, fig.width=3.5}


a <- ggplot(OGs_sum, aes(x = as.factor(num_sources), y = max_d2_source, fill = as.factor(num_nutree))) + 
  geom_boxplot(show.legend = FALSE)+
  labs(x = "Number of Sources", y = "Distance to Source")+
  scale_fill_brewer(palette = "Greys")+ 
  base_theme


b <- ggplot(run_data, aes(x = as.factor(num_sources), y = run_data$n_trees_available_end - run_data$n_trees_available_start, fill = as.factor(num_nutree)))+
  geom_boxplot(show.legend = FALSE) +
  scale_y_log10() + 
  scale_fill_brewer(palette = "Greys")+
  labs(x = "Number of Sources", y = "N new trees")+ 
  base_theme

leg <- ggplot(OGs_sum, aes(x = as.factor(num_sources), y = max_d2_source, fill = as.factor(num_nutree))) + 
  geom_boxplot() + scale_fill_brewer(palette = "Greys") + 
  labs(fill = "Number of Trees")+
  theme(legend.direction = "horizontal", 
        legend.position = c(.5,.5), 
        legend.title = element_text(size = 6),
        legend.text = element_text(size = 5),
        legend.key.size = unit(.5, "line"),
        plot.margin = unit(c(0,0,0,0), "cm"))

leg <- ggpubr::get_legend(leg)

lay <- rbind(c(NA,1,1,NA),
             c(2,2,3,3),
             c(2,2,3,3))

grid.arrange(leg,a,b, layout_matrix = lay)
```

  One of the simplest and expected outcomes of the model is that small scale tool use can occur when a _Tree_ and a _Source_ occur within a 3 grid cell radius of each other. Tool use did not occur in `r per_runs_no_tool_use`% of the runs due to the fact that _Trees_ were never close enough to a _Source_. This was predominantly the case in model iterations where both the number of _Sources_ and _Trees_ included in the model were low (SOM: Table 1). Therefore simply increasing both the number of _Sources_ or _Trees_ increases the number of places and ultimately the likelihood that tool use can occur (SOM Figure 1: left, ANOVA, F: `r res_F_trees`, P-value: `r res_P_trees`).  

  When tool use does occur, `r per_maxD_greater_than_three`% of model iterations, led to movement of _Pounding Tools_ across beyond the initial constraints of the landscape. When a Pounding Tool is moved from a _Source_ to the location of a _Tree_, it becomes a secondary source of raw material for other _Trees_ in the vicinity. Over time, provided that Trees occur within a 3-grid cell radius of each other, the repeated transport of _Pounding Tools_ incrementally moves Pounding Tools up to a maximum distance of `r max_d` grid cells from its _Source_. The maximum distance a _Pounding Tool_ can be moved is attenuated by the number of _Trees_ in the model run. _Pounding Tools_ move greater distances the number of _Trees_ is greater (Figure \ref{d2source}, left).  In addition, the small nature of breakage fragments relative to the size of the _Pounding Tool_ allows _Pounding Tools_ to be used and transported 10s to 100s of times prior to total exhaustion allowing tools of all qualities to be moved substantial distances from their _Sources_ (SOM Table 2). Nevertheless, _Pounding Tools_ of higher quality will move greater maximum distances from _Sources_ prior to exhaustion. The size of the _Pounding Tool_ also influences the maximum distance a pounding tool can be moved (SOM Figure 2). This is because both of these variables influence the number of times _Pounding Tools_ can be used and subsequently transported (i.e. use-life). This incremental transport of _Pounding Tools_ away from their sources consequently  increases the number of locations where tool use can occur in `r per_runs_new_trees`% of the runs (Figure \ref{d2source}, right). In other words, the repeated transport of tools across the landscape increases the number of opportunities for tool-use on a given landscape. The 12% of Model runs that did not lead to an increased access of Trees for nut-cracking are predominantly those where the number of _Trees_ or _Sources_ are initially low (SOM Table 3).

  Interestingly, the changing locations of _Trees_, due to natural growth and death cycles also strongly influences the above described pattern. When holding the number of _Sources_, and _Trees_ constant, iterations where _Trees_ grow and die further increases the number of trees that became available as loci for tool use (SOM Figures 3, 4). When _Tree_ locations remains static (i.e. they do not die or grow), the number of _Trees_ that are accessible for tool use events eventually plateaus thus limiting the area in which _Pounding Tools_ can be redistributed (Figure \ref{tree_death}, left). In contrast. the accessibility of _Trees_ for tool use does not diminish when Trees change locations over time instead, the number of _Trees_ where tool use can occur continues to increase over time (Figure \ref{tree_death}, right) in spite of the fact that _Pounding Tool_ use and _Tree_ life cycle operate on different temporal scales, the results show that the interaction of these processes continuously increase the availability of the _Trees_ across the landscape over time. 

```{r figure-2, echo=FALSE, warning=FALSE, message=FALSE,fig.height=2, fig.width=3.5, fig.cap="The effect of tree death and growth and the number of trees that come available due to the small scale transport of _Pounding Tools_. When _trees_ remain in a the same location (**Left**) the number of new trees that can be accessed due to the incremental transport of *Pounding Tools* raises and then eventually plateaus. However, when *Trees* die and grow (**Right**), these slow changes in the locations of the trees further promotes the incidental movement of *Pounding Tools* away from their *Sources* \\label{tree_death}"}


env_data <- fread("../../Panda_ABM_Analysis/Data/EXP12_Mem_Safe_Env_75k_100s_2000t.csv")

key <- c("Static Trees", "Dynamic Trees")
names(key) <- c(0,1)

for(id in unique(env_data$run_id)){
  n <- nrow(env_data[env_data$run_id == id,])
  env_data$ts[env_data$run_id == id] <- c(0:(n-1))
}

env_data <- subset(env_data, !(ts %in% c(0)))

env_data <- left_join(env_data, run_data)

ggplot(env_data, aes(x = ts, y = as.numeric(trees_available))) +
  geom_path(aes(group = run_id), alpha = .5) +
  labs(x = "Time", y = "Number of Trees Available")+
  facet_wrap(~treessdie, labeller = labeller(treessdie = key))+
  base_theme

```

### Material Signature

The spatial distribution, density and composition of the resulting material record is dependent on the aspects of the landscape that facilitate the movement of _Pounding Tools_ across space. When _Trees_ are infrequent, the resulting assemblages form localized patches in the grid-cells nearest to _Sources_ (Figure \ref{distribution}, Top left). As small scale transport is able to move _Pounding Tools_  move more freely as the number of Trees increases the subsequent archaeological record becomes more widely spread (Figure \ref{distribution}, Top Right). As a result, the growth and death of _Trees_ has a substantial effect on the size and dispersion of the archaeological record across space (Figure \ref{distribution}). Holding the number of _Trees_  and the number _Sources_ constant, more grids cells accumulate archaeological assemblages in model iterations where _Trees_ grow and die in comparison with those where _Trees_ do not change location. These results show that the interaction between small scale tool transport and use with resource distribution and longer term environmental change can substantially influence the structure of the archaeological record.


```{r figure 3, fig.height=3.5, fig.width=7, message=FALSE, warning=FALSE, include=FALSE}

maptheme <- base_theme + theme(axis.title = element_blank(),
                               axis.text = element_blank(),
                               axis.ticks = element_blank())

xsources <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_A_sources.csv")
xtrees <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_A_trees.csv")
xtools <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_A_tools.csv")
xtools <- xtools %>% group_by(x,y) %>% summarise(N_tools = n())

xsources$type = "Stone source"

a <- ggplot() +
    geom_raster(data = xtools, aes(x = x, y = y))+
    geom_point(data = xsources, aes(x = x, y = y, color = "grey"), size = 1)+
  coord_equal()+ 
  scale_x_continuous(limits = c(0,250)) +
scale_y_continuous(limits = c(0,250)) + 
  ggtitle("A")+
  maptheme + theme(legend.position = "none")
  

xsources <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_b_sources.csv")
xtrees <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_b_trees.csv")
xtools <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_b_tools.csv")
xtools <- xtools %>% group_by(x,y) %>% summarise(N_tools = n())

xsources$type = "Stone source"

b <- ggplot() +
    geom_raster(data = xtools, aes(x = x, y = y, fill = N_tools))+
    geom_point(data = xsources, aes(x = x, y = y, color = "grey"), size = 1)+
  coord_equal()+ 
  scale_x_continuous(limits = c(0,250)) +
  scale_y_continuous(limits = c(0,250)) +
  ggtitle("B")+
  maptheme +  theme(legend.position = "none")


xsources <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_c_sources.csv")
xtrees <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_c_trees.csv")
xtools <- fread("../../Panda_ABM_Analysis/Data/Figure_3/Plot_c_tools.csv")
xtools <- xtools %>% group_by(x,y) %>% summarise(N_tools = n())

xsources$type = "Stone source"

c <- ggplot() +
    geom_raster(data = xtools, aes(x = x, y = y, fill = N_tools))+
    geom_point(data = xsources, aes(x = x, y = y, color = "grey"), size = 1)+
  coord_equal()+ 
  scale_x_continuous(limits = c(0,250)) +
scale_y_continuous(limits = c(0,250)) +
  ggtitle("C")+
  maptheme + 
  theme(legend.position = "none")

xsources$type = " "

leg <- ggplot() +
    geom_raster(data = xtools, aes(x = x, y = y, fill = N_tools))+
    geom_point(data = xsources, aes(x = x, y = y, color = type), size = 1)+
  coord_equal()+ 
  scale_x_continuous(limits = c(0,250)) +
scale_y_continuous(limits = c(0,250)) +
  ggtitle("C")+
    labs(fill = "Number of Tools", color = "Stone Source")+
  maptheme + 
  theme(legend.position = "top")

leg <- ggpubr::get_legend(leg)


lay <- rbind(c(1,1,2,2,3,3),
             c(1,1,2,2,3,3),
             c(4,4,4,4,4,4))

grid.arrange(a,b,c,leg,
             layout_matrix = lay)

```

\begin{figure*}

\includegraphics[width=6.5in]{Reeves_et_al_2021_Panda_ABM_files/figure-latex/figure 3-1.pdf}

\caption{A: The archaeological record when there are 100 sources and 100 trees. Notice that the subsequent archaeological record forms extremely localized patches of material. B: The archaeological record there 100 sources and 2000 trees. This archaeological record is becoming more wide-spread but remains localized. C: The archaeological record there 100 sources and 2000 trees where trees can die and regrow. The notice how the the growth and death of trees becomes substantially more widespread.}

\label{distribution}

\end{figure*}

 In addition, the density of discarded material, as well as the size of the _Pounding Tools_ are also structured across space. The amount of discarded material per grid cell also forms a noisy  distance-decay relationship as the distance to the nearest source increases (Figure 4, SOM Figure 5). The noise in the pattern is due to the fact that tool-use and the location of trees are spatially auto-correlated. If trees occur in such a way that allows _Pounding Tools_ to move from tree to tree away from primary raw material sources, then a distance-decay pattern will form. If, however, a single _Tree_ occurs in isolation in proximity to a primary raw material source, then hammer-stones will be used without being transported further than the location of the tree. As a result, in model runs where the number of _Trees_ permit, the repeated movement and use of _Pounding Tools_ results in a distance–decay relationship where the range and average _Pounding Tool_ size  decreases as distance from its primary raw material source increases (Figures 4, SOM Fig. 6, SOM Fig. 7).

  Although _Pounding Tools_ are the only tool used within the model they not are homogeneously distributed across the simulated landscape. The number of _Pounding Tools_ within a given grid-cell also follows a sharp distance-decay relationship with the nearest _Source_. In other words, _Pounding tools_ are found in there highest quantities in assemblages nearest to _Sources_ and become increasing scarce as the distance to the nearest _Source_ increases. In fact, 78% of the grid-cells that form material assemblages are comprised entirely of fragments or exhausted Pounding Tools. An additional 11% of the grid-cells contain a single exhausted _Pounding Tool_.


```{r figure 4, fig.height=2.5, fig.width=6, include=FALSE}


tools <- fread("../../Panda_ABM_Analysis/Data/EXP12_MemSafe_tools_75k.csv")
tools$s_id <- paste(tools$run_id, tools$source_id)
source_join <- sources[,c("s_id", "x", "y")]
colnames(source_join) <- c("s_id", "s_x", "s_y")
tools <- left_join(tools, source_join, by = c("s_id" = "s_id"))
tools$d2source <- sqrt(((tools$x-tools$s_x)^2) + ((tools$y-tools$s_y)^2))

tools_sum <- tools %>% 
  group_by(run_id, x, y) %>%
  summarise(n_tools = n(),
            min_d2_source = min(d2source),
            n_pounding = sum(Tool_size >=2000))
tools_sum <- left_join(tools_sum, run_data)

Tool_sum_sub <- subset(tools_sum, num_sources == 100 & num_nutree == 2000 & treessdie == 1)
OGs_75k <- subset(tools, parent_id == "OG")
OGs_sum <- OGs_75k %>% group_by(run_id, x, y) %>%
  summarise(n_hammers = n(),
            min_d2_source = min(d2source),
            med_d2_source = median(d2source),
            max_d2_source = max(d2source),
            mean_uses = mean(n_uses))


a <- ggplot(Tool_sum_sub, aes(x = min_d2_source, y= n_tools)) + 
  geom_point() + 
  labs(x = "Minimum Distance to Source",
       y = "Number of artifacts") + 
  base_theme

test <- left_join(OGs_sum, run_data, by = c("run_id" = "run_id"))
OGs_sum_sub <- subset(test, num_sources == 100 & num_nutree == 2000 & treessdie == 1)

b <- ggplot(OGs_sum_sub, aes(x = min_d2_source, y = n_hammers)) + geom_point() + 
    labs(x = "Minimum Distance to Source",
       y = "Number of Pounding Tools") + 
  base_theme

OGS_sub <- subset(OGs_75k, num_sources == 100 & num_nutree == 2000 & treessdie == 1)

c <- ggplot(OGS_sub, aes(x = d2source, y=Tool_size)) + geom_point() + 
  labs(x = "Distance to Source",
       y = "Pounding Tool Size") + 
  base_theme

grid.arrange(a,b,c, ncol=3)


```


Discussion
=============

  The results of our model elucidate the relationship tool-use involving short term transport,  between resource density (number of Sources and Pounding Tools), environmental change, and the formation of the archaeological record. While these results illustrate how the distribution of resources within an environment ultimately constrains the opportunities for  tool-use, specific configurations of resources – particularly those with large numbers of _Trees_ – can have a long lasting influence on the distribution of materials needed for tool use. The model also shows how short term instances of tool transportation can lead to the movement of _Pounding Tools_ across long distances over time thus increasing the number of opportunities for tool use. This long term modification of the landscape is further encouraged by the widespread distribution of foraging opportunities to use tools (in our model _Trees_). These dynamics not only influence the prevalence of locations where it is possible to forage where tools are necessary but also the structure of the resulting archaeological record. 
	
\begin{figure*}

\includegraphics[width=6.5in]{Reeves_et_al_2021_Panda_ABM_files/figure-latex/figure 4-1.pdf}

\caption{Left: A scatter plot showing the relationship between the number of artifacts (e.g. Pounding Tools and fragments) present within a grid-cell and its distance to the nearest source. Grid-cells closer to sources can possess a wider range of artifacts, whereas grid-cells farther from the source consistently possess few artifacts. Middle: Scatter plot showing the relationship of the number Pounding Tools in a grid cell with the distance to the nearest source. Right: The relationship between Pounding Tool size and distance to its source. Note: All plots show runs where the number of sources is 100 and the number of trees is 2000. See SOM figures 5, 6, and for other model runs.}

\label{assemblages}

\end{figure*}

### Environmental Facilitators of Tool Use

  It has often been argued that patterns of tool assisted foraging are driven by encounter rates with resources requiring and raw material needed for tool use [@foxIntelligentToolUse1999; @koopsEcologyCultureEnvironmental2013]. The results of our model provide further support for this hypothesis by showing that when tool-using behavior is expedient, the number of opportunities use tools is entirely regulated by the frequency and co-occurrence of resources and sources of material in space. Nevertheless, when there are certain configurations of resources, even short bouts of transport can have long term effects on the spatial distribution tool materials and the number of opportunities for tool use beyond what the structure of the landscape naturally allows. In these situations, opportunities for tool-use are not limited by the constraints of the environment and can even be increased by the tool using behavior itself. This work shows that even small scale tool using behaviors have the capacity to modify the availability of a resource through the redistribution tool material. In this light, the model illustrates the niche constructing capacity of such small scale tool using behaviors as increasing the availability of tool-facilitated resources also increases number of times an individual encounters tool using opportunities. 

​	In addition, the model demonstrates how these small scale tool using behaviors generate positive feedback with the changes in tool-use locations that further enhances the availability of resources and the number of tool using opportunities over the long term. Moreover, the fact that the model   Though environmental dynamics are often argued to influence behavioral patterns across evolutionary time-scales but, such arguments lack mechanisms that causally link the two processes together [@behrensmeyerClimateChangeHuman2006; @kingstonShiftingAdaptiveLandscapes2007; @stinerChallengesDocumentingCoevolution2020]. Our model contributes to this discussion by illustrating how processes that operate on different temporal scales produces feedback.  While the model does not consider reproduction, these results may imply that new generations of a population where such feedback is in effect inherit a landscape in which resources associated with this type of tool using behavior are more accessible than they were in previous generations. 

### Implications for Chimpanzee Stone Tool Use

Although stone tool use among _Pan_ is considered to be highly constrained by the environment [@carvalhoToolcompositeReuseWild2009], the results of the model imply Chimpanzees have to capacity to modify their environments in a way that may have a lasting effect the landscape that is inherited by future generations of Chimpanzees. Nut-cracking hammerstones are recorded up to 2 kilometers from the nearest naturally occurring source of stone in the Tai Forest. Moreover, these hammers have been shown follow a distance-decay pattern where hammers are smaller are more utilized the farther they are found from the nearest source [@lunczDistancedecayEffectStone2016]. This spatial patterning is consistent with the results of the model and may such suggest that the Chimpanzees of the Tai Forest may be modifying distribution of tool using materials. Although tool transport and use within the model is hard-coded into the agent’s behavior within our model, tool use, within chimpanzee populations, has previously been described as a socially learned behavior [@lunczPrimateArchaeologyReveals2015; @whitenCulturalPanthropology2003; @whitenCulturesChimpanzees1999]. As such, the results of our model within the context of chimpanzee behavior suggest that chimpanzees may unintentionally modify their accessibility to resources through a culturally learned behavior. Increasing the number of opportunities for tool use also increases the number of social opportunities for learning and the transmission of tool using skills [@koopsEcologyCultureEnvironmental2013]. In this sense, the results of our model shows how short term bouts of transport also may reinforce the prevalence of tool use within chimpanzee populations by causing future generations to inherit a landscape in which the number of tool-use opportunities is greater than if was before. 

However, unlike the model percussive tools do not accumulate at tool-use sites nearest to sources but rather remain infrequent across the landscape. This maybe related to a combination of the minimum distance of nut-trees to a source of stone and transport costs or even an additional bias to re-use tools as opposed acquiring new material from a source. This difference between the model and nut-cracking in the Tai Forest, may highlight the delicate balance between the environment, availability of tool using resources, and behavior, that attenuates the spatial-temporal impact of small scale tool using behaviors on the landscape.

### Implications for hominin evolution 

​	One of the hallmarks of hominin and human niche is the capacity to enable to increase their access to resources through the transport and reuse of tool material [@binfordWillowSmokeDogs1980; @kuhnMousterianLithicTechnology1995; @pottsWhyOldowanPlioPleistocene1991; @schickModelingFormationEarly1987]. The relocation of such materials into material poor areas, effectively makes a lasting change to the environment which, in turn conditions, the mobility, foraging, or even settlement strategies of future generations [@braunEcosystemEngineeringQuaternary2020; @haasForagerMobilityConstructed2019; @iovitaOperationalizingNicheConstruction2021; @lalandNicheConstructionBiological2000]. Within this context, our model shows that even transport over short distances can modify landscapes in such a way that increases, both the opportunities for tool use and the accessibility of resources.

 	It may be that such interactions between the distribution of resources and short term tool transport behavior had the capacity to generate feedback that may have influenced the role tool use in  hominin evolution. For example, percussive tools may facilitated access to animal protein through the breakage bones prior to the emergence core and flake technology [@thompsonOriginsHumanPredatory2019]. Within the context of the model it is plausible, that the interaction between short distance transport of percussive tools and the changing locations of animal carcasses as the result of the emergence of new kills and the decomposition of old kills, would have created a dynamic that would systematically seed a lake margin environment with percussive tools. This would increase both the number of opportunities and encounter rates with scavengable carcasses and in turn increase the contribution of animal protein to the hominin diet. Such encounter rates would have been critical to recognizing animal carcasses as a food resource and its increased consumption over time [@thompsonOriginsHumanPredatory2019]. In may that simple interactions between local environmental dynamics and tool transport may have contributed to the increased consumption of protein which is argued to have played an important role in hominin brain evolution and even the emergence of _H. erectus_ [@antonEvolutionEarlyHomo2014; @lalandNicheConstructionBiological2000; @pattersonComparativeIsotopicEvidence2019].

### Implications for the archaeological record 

  In order to understand if the processes illustrated in the model had bearing on the past, evidence of such dynamics must gleaned from a static material record. As such, the results of the model provides novel insights into the transformation of these processes into an archaeological record. Percussive tools are the most characteristic artefact of the primate stone tool record and are well described in both human and nonhuman primates [@arroyoPoundingToolsHWK2018; @benito-calvoFirstGISAnalysis2015]. The results of the model illustrate how the tangible traces on left on percussive tools in terms of their degree of utilization and their distance from their source location are result of this interaction between external and behavioral processes. Both of these attributes can be inferred from archaeological contexts [@lathamNondestructiveXrfCharacterization1992; @lunczDistancedecayEffectStone2016]. 

  However, documenting this pattern in an archaeological context is far more complex. While the results of this study show that in some circumstances, primate percussive behavior can produce a wide spread material record the ubiquity of pounding tools across the landscape is not homogenous. The percussive tools only occur in large quantities in assemblages where stone is readily available (i.e. close to Sources) and are relatively scarce or even absent in areas more distant from sources. In these distant places suitable pounding tools less available and therefore more likely to be transported more often. If there is a need to continuously transport and utilize the same hammerstones, as is observed in the model, then there may be little opportunity for tools to enter the archaeological record whole. Such tools may only enter the archaeological record as fragments or as an exhausted tool, at which point, they become almost archaeologically invisible [@schifferFormationProcessesArchaeological1987].   This phenomenon is echoed in the Tai Forest, for example, stone tool use was continuously observed from 1979 to 1983 site of Panda 100, until the death of the tree in 1984 [@boeschWildCulturesComparison2014]. Yet, archaeological investigation of the site yielded little to no evidence of complete hammerstones, suggesting that the discarded hammer stones at  the once live tree become a secondary source of material for other nut bearing trees [@mercaderExcavationChimpanzeeStone2002; @proffittRevisitingPanda1002018]. 

  Although there is currently no physical evidence, it has been postulated that a culture of percussive technology similar to that of modern-day chimpanzees may have existed prior to the earliest known archaeological evidence of early hominins [@carvalhoToolcompositeReuseWild2009; @mcgrewChimpanzeeMaterialCulture1992; @mcgrewSearchLastCommon2010]. Few expectations have, however, been set forth regarding the composition of this archaeological record. Here we build upon the expectations of Panger et al. [@pangerOlderOldowanRethinking2003] by illustrating how the structure of the environment influences structure of the archaeological record. The results of this model suggest that the associated record may range from a few localized patches to a widespread distribution of archaeological sites throughout the landscape. If the earliest durable evidence of hominin tool-use is manifested as percussive tools then this record may be difficult to recover. While the model does show that this behavior can lead to the aggregation of large quantities of percussive tools, it also suggests that such localities are rare. In other environmental circumstances the archaeological record is far more wide spread, but most assemblages would be comprised of mostly fragments. Such a record, even if widespread, would be difficult to recognize as early forms of tool use let alone distinguish from non-anthropogenic processes.  

Conclusion
===========

Though small scale tool-use is ultimately constrained by its environment. This model shows that hammerstone transport  over time can have a significant effect  on the facilitation of tool behavior itself. The aggregate effect of short transportation events can improve the accessibility of resources within a landscape over time. This landscape pattern of unintentional tool provisioning not only potentially mitigates against local changes in the availability of resources but also increases the opportunity for nut cracking to be carried out. In this sense this tool-using behavior provides chimpanzees and potentially other tool-using non-human primates the capacity to positively modify their environments.. In the context of living Chimpanzee populations, the results of the model in combination with ethological data have the potential to incrementally modify their environments through a culturally learned behaviors.   

<!-- Leave these lines as they are at the end of your .Rmd file to ensure placement of methods & acknowledgements sections before the references-->

\showmatmethods
\showacknow
\pnasbreak
