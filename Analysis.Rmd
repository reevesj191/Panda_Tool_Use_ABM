---
title: "Notebook: Results of Panda Model"
author: "Jonathan Reeves"
date: "12-21-2020"
output:
  pdf_document: default
  
header-includes:
 \usepackage{float}
 \floatplacement{figure}{H}
---

```{r setup, include=FALSE}
library(knitr)
library(data.table) 
library(dplyr)
library(ggplot2)
library(grid)
library(gridExtra)

knitr::opts_chunk$set(
  echo = FALSE, 
  comment = FALSE,
  warning = FALSE)

run_data <- fread("EXP_2_25k_run_data.csv")
sources <- fread("EXP_2_25K_sources.csv")
trees <- fread("EXP_2_25K_trees.csv")
tools <- fread("EXP_2_25k_tools.csv")

sources$s_id <- paste(sources$run_id, sources$id)
tools$s_id <- paste(tools$run_id, tools$source_id)
source_join <- sources[,c("s_id", "x", "y")]
colnames(source_join) <- c("s_id", "s_x", "s_y")
tools <- left_join(tools, source_join, by = c("s_id" = "s_id"))
tools$d2source <- sqrt(((tools$x-tools$s_x)^2) + ((tools$y-tools$s_y)^2))

OGs <- subset(tools, Tool_size >= 2000)
OGs <- left_join(OGs, run_data)

```

# 1.0  Spatial distribution of the records

```{r}
run_sum <- tools %>% 
  group_by(run_id, x, y) %>%
  summarise(n_tools = n()) %>%
  group_by(run_id) %>%
  summarise(n_tool_cells = n(),
            per_tool_cells = (n()/(250*250)),
            mean_n = mean(n_tools),
            var_n = var(n_tools),)

run_sum$var2mean <- run_sum$var_n/run_sum$mean_n

run_sum <- left_join(run_sum, run_data, by = c("run_id"="run_id"))
```

## 1.1 Environmental Facilitators of Tool-Use

```{r fig.height=4.5, fig.width=6.5, fig.cap= "Boxplots showing the influence of both the number of sources and trees on distribution of the archaeological record. Note that the Y axis is in log scale for visualization purposes. \\label{sourcetreeboxplot}"}

ggplot(run_sum, aes(x = as.factor(num_sources), y = n_tool_cells, fill = as.factor(num_nutree)))+ geom_boxplot()+scale_y_log10()
```
  
  The expedient nature of the modeled nut-cracking behavior tethers the formation of artifact assemblages to the locations of trees and the 8 neighboring grid-cells. To examine the visibility or the size of the archaeological record produced we can use the number of grid cells that contain discard artifacts as a means to investigate the influence of the number of sources and number trees on the formation of this lithic record under the assumptions of the model. Figure \ref{sourcetreeboxplot} shows the influence the quantity of trees and sources on the number of grid cells that accumulate a material record during the model run. This plot shows that both sources and trees have a positive effect on the number of grid-cells that accumulate archaeological assemblages. When the number of trees and sources are low the number of grid-cells or "sites" is low. However, as density of sources and trees increases do the number of sites. Recall that the model is set up so that a source or pounding tool must be within a 2-3 gridcell radius of a tree in order for a nut cracking even to occur. This means that at the beginning of the simulation nut cracking can only occur within places where sources and trees occur within this small radius. Since, the initial placement of sources and trees in any given model run is random, the likelihood of a tree and source occuring with a distance of 3 grid-cells or less depends on the number trees and sources within the model. 
  
  When the number of trees and sources in the model is low, the number of places were sources and trees occur close enough to one another to trigger a nutcracking event will likely be few. This results in the creation of localized assemblages within 1-2 grid-cells of trees and sources (Figure \ref{s100t100}). Intuitively, increasing both the number of sources and trees in the model run, increases the likelihood of a source and tree will occur with in this critical 2-3 grid-cell radius of eachother. This in turn increases the number of localized assemblages that are created during the model run (Figure \ref{s100t100}).
  
```{r fig.cap= "Example of a model runs that illustrate the effect of the number of trees on the formation of lithic assemblages. Note that not only does increasing the number of trees increase the number of nut-cracking opportunies but it allows for pounding tools to jump from tree to tree. Key: Sources = Brown, Trees = Green, Sites = Black. \\label{s100t100}", fig.height=4, fig.width=6.5}
 
nsources <- 100
samp <- subset(run_data, num_sources == nsources & num_nutree == 100 & treessdie == 0)
rand_id <- samp$run_id[sample(1:nrow(samp), 1)]
  
a <- ggplot(tools[tools$run_id == rand_id,], aes(x = x, y = y)) +
    geom_point()+
    geom_point(data = sources[sources$run_id == rand_id], color = "brown", size = .5)+
    geom_point(data = trees[trees$run_id == rand_id], color = "green", size = .5)+
    coord_equal()+
    scale_x_continuous(limits = c(0,250))+
    scale_y_continuous(limits = c(0,250))+
    ggtitle(label = paste("N Sources:", nsources))+
    theme_bw()

nsources <- 500

samp <- subset(run_data, num_sources == nsources & num_nutree == 100 & treessdie == 0)
rand_id <- samp$run_id[sample(1:nrow(samp), 1)]
  
b <- ggplot(tools[tools$run_id == rand_id,], aes(x = x, y = y)) +
    geom_point()+
    geom_point(data = sources[sources$run_id == rand_id], color = "brown", size = .5)+
    geom_point(data = trees[trees$run_id == rand_id], color = "green", size = .5)+
    coord_equal()+
    scale_x_continuous(limits = c(0,250))+
    scale_y_continuous(limits = c(0,250))+
    ggtitle(label = paste("N Sources:", nsources))+
    theme_bw()

grid.arrange(a,b, ncol = 2)
```

   In addition, increasing the density of trees within the model as will increases the likelihood that trees will cluster in some parts of the grid-space more closely together than others. This is to be be expected given that the placement of the trees within the model is random. This spatial pattern creates an interaction with the tool transport and discard behavior. When a tool is moved from a source and discarded near a tree, it is now also closer to other trees in the grid space. If trees are close enough together, the discard of the tool at one tree facilates nutcracking at another tree that was not within close proximity to a source. In other words, the movement of a tool towards one tree, in some cases, enables nut-cracking to occur at another regardless of its location to a source (figure\ref{s100t1000}). If trees are clustered close enough together, over time tools will island hop across many trees. This in turn facilates nutcracking and discard of tools and fragments at many more trees than those that occur within 3 grid-cells of a source. The resulting material record, in turn, becomes more widespread, as nut cracking becomes more accessible across the landscape. 
  
```{r fig.cap= "Example of a model run (number of sources 500, number of trees: 1000. When there are larger numbers of trees, there is a greater likelihood that trees occur in clumps which facilitates the movement of stones father from their sources.). \\label{s100t1000}", fig.height=4, fig.width=4}
set.seed(1)
nsources <- 100
samp <- subset(run_data, num_sources == nsources & num_nutree == 1000 & treessdie == 0)
rand_id <- samp$run_id[sample(1:nrow(samp), 1)]
  
ggplot(tools[tools$run_id == rand_id,], aes(x = x, y = y)) +
    geom_point()+
    geom_point(data = sources[sources$run_id == rand_id], color = "brown")+
    geom_point(data = trees[trees$run_id == rand_id], color = "green")+
    coord_equal()+
    scale_x_continuous(limits = c(0,250))+
    scale_y_continuous(limits = c(0,250))+
    ggtitle(label = paste("N Sources:", nsources))+
    theme_bw()
  
```

### Death and Regrowth of trees

  The previously described pattern is further facilated by the death and regrowth of trees. On average, more grid-cells accumulate artifact assemblages in model runs where trees die and regrow (Figure: \ref{treedeathmap}). This is due to the fact that nut-cracking can occur a more locations during the model run. Moreover, accumulated assemblages at locations where nut-cracking can no longer occur due to the death of a tree, in turn, act as potentential sources of material to trees that do not occur near a source-agent. This processes produces a feedback loop in which the number of potential sources (source-agents, and stone assemblages with use-able stone) increases through time. As a result, nut-cracking becomes more accessible across the grid-space and its archaeological signature becomes more wide spread.
  
```{r fig.cap= "Example runs illustrating the effect of tree death and regrowth on the distribution of the archaeological assemblages. Notice that there are a greater number of tool using sites in the right panel where trees regrow and die than in the left panel where they do not. \\label{treedeathmap}", fig.height=6.5, fig.width=6.5}

time_run_data <- fread("EXP_2_ns100_run_data.csv")
time_tools <- fread("EXP_2_ns100_tools.csv")
time_tools <- left_join(time_tools, time_run_data)

samp <- subset(time_run_data, n_time_steps == 25000 & treessdie == 0 & num_nutree == 1000)

rand_id <- samp$run_id[sample(1:nrow(samp), 1)]
  
a <- ggplot(time_tools[time_tools$run_id == rand_id,], aes(x = x, y = y)) +
    geom_bin2d(bins = 250, show.legend = FALSE)+
    #geom_point(data = sources[sources$run_id == rand_id], color = "brown", size = .5)+
    coord_equal()+
    scale_x_continuous(limits = c(0,250))+
    scale_y_continuous(limits = c(0,250))+
    ggtitle(label = paste("Immortal Trees: 25k Time Steps"))+
    theme_bw()

samp <- subset(time_run_data, n_time_steps == 25000 & treessdie == 1 & num_nutree == 1000)
rand_id <- samp$run_id[sample(1:nrow(samp), 1)]

b <- ggplot(time_tools[time_tools$run_id == rand_id,], aes(x = x, y = y)) +
    geom_bin2d(bins = 250, show.legend = FALSE)+
    #geom_point(data = sources[sources$run_id == rand_id], color = "brown", size = .5)+
    coord_equal()+
    scale_x_continuous(limits = c(0,250))+
    scale_y_continuous(limits = c(0,250))+
    ggtitle(label = paste("Trees Die and Regrow: 25k Time Steps"))+
    theme_bw()
  
samp <- subset(time_run_data, n_time_steps == 50000 & treessdie == 1 & num_nutree == 1000)
rand_id <- samp$run_id[sample(1:nrow(samp), 1)]

c <- ggplot(time_tools[time_tools$run_id == rand_id,], aes(x = x, y = y)) +
    geom_bin2d(bins = 250, show.legend = FALSE)+
    #geom_point(data = sources[sources$run_id == rand_id], color = "brown", size = .5)+
    coord_equal()+
    scale_x_continuous(limits = c(0,250))+
    scale_y_continuous(limits = c(0,250))+
    ggtitle(label = paste("Trees Die and Regrow: 50k Time Steps"))+
    theme_bw()

samp <- subset(time_run_data, n_time_steps == 75000 & treessdie == 1 & num_nutree == 1000)
rand_id <- samp$run_id[sample(1:nrow(samp), 1)]

d <- ggplot(time_tools[time_tools$run_id == rand_id,], aes(x = x, y = y)) +
    geom_bin2d(bins = 250, show.legend = FALSE)+
    #geom_point(data = sources[sources$run_id == rand_id], color = "brown", size = .5)+
    coord_equal()+
    scale_x_continuous(limits = c(0,250))+
    scale_y_continuous(limits = c(0,250))+
    ggtitle(label = paste("Trees Die and Regrow: 75k Time Steps"))+
    theme_bw()

grid.arrange(a,b,c,d,
             ncol = 2)
```

  The same phenomenon can also be visualized as boxplots \ref{time_boxplot}. Here the red boxplots show that when trees do not die the number of grid-cells that accumulate lithics remains similar of unchanging through time. However, as shown by the green box plots when trees die and regrow the number grid-cells that accumulate lithics is substantially greater and increases linearly through time.  
  
```{r fig.height=3, fig.width=3, fig.cap= "Boxplots showing the influence of both the number of sources and trees on distribution of the archaeological record. Note that the Y axis is in log scale for visualization purposes. \\label{time_boxplot}"}

time_run_sum <- time_tools %>% 
  group_by(run_id, x, y) %>%
  summarise(n_tools = n()) %>%
  group_by(run_id) %>%
  summarise(n_tool_cells = n(),
            per_tool_cells = (n()/(250*250)),
            mean_n = mean(n_tools),
            var_n = var(n_tools))
time_run_sum <- left_join(time_run_sum, time_run_data, by = c("run_id"="run_id"))
sub <- subset(time_run_sum, num_sources == 100 & num_nutree == 1000)
ggplot(sub, aes(x = as.factor(n_time_steps), y = n_tool_cells, fill = as.factor(treessdie)))+ geom_boxplot()+theme(legend.position = "top")
```

  
### Distance from source

This the behavioral process described above can be observed using archaeological proxies as well. For example, distance a tool travels from the source should be related to the number of trees in the model and whether they die or not.

```{r fig.cap= "The effect of number of trees on distance to source values \\label{d2source}", fig.height= 4, fig.width=6.5}

tools <- left_join(tools, run_data)
dist_sum <- tools %>% 
  group_by(num_sources, num_nutree, treessdie) %>%
  summarise(min_d2source = min(d2source),
            mean_d2source = mean(d2source),
            max_d2source = max(d2source))

a <- ggplot(dist_sum, aes(x = as.factor(num_nutree), y = mean_d2source, fill = as.factor(treessdie))) +
  geom_boxplot()+
  theme(legend.position = "top")
b <- ggplot(dist_sum, aes(x = as.factor(num_nutree), y = max_d2source, fill = as.factor(treessdie))) + 
  geom_boxplot() + 
  theme(legend.position = "top")

grid.arrange(a,b, ncol = 2)
```
  
  This plot shows the effect of tree density on distance to source , also see \ref{d2source}). It is clear that tree density has a significant and systematic impact on the distance tools move from their sources. In sum, the more trees there are in a given model run, the farther the tools are moved from there soure. In addition, tools from model runs where trees die and regrow (shown in black), are transported farther from the source that when trees remain at a fixed location (Red vs Green). However, the difference in the average distance traveled between runs with 100 trees in the model and those with 1000 is at most a little more than a single grid-cell. However, looking at the maximum distance a tool can travel shows a greater difference (approximately 9 grid-cells). In addition, the effect of trees dying and regrowing is at most 1 grid-cell. Based on the maximum distance to source (Right side of the plot), tree density and tree death and regrowth can have a substantial impact on how far any tool travels but on average this influence is small.
  
  This shows that within the model the distance a tool travels is based on the configuration of trees in relation to sources. Tools will only travel substantial distances from their sources if there are enough trees close enough together to allow them to do so (See figure \ref{s100t1000}). Figure \ref{d2source} shows that although it is possible it remains rare in the presented batch of model runs (25k time steps).

```{r}
time_sources <- fread("EXP_2_ns100_sources.csv")
time_sources$s_id <- paste(time_sources$run_id, time_sources$id)
time_tools$s_id <- paste(time_tools$run_id, time_tools$source_id)
time_source_join <- time_sources[,c("s_id", "x", "y")]
colnames(time_source_join) <- c("s_id", "s_x", "s_y")
time_tools <- left_join(time_tools, time_source_join, by = c("s_id" = "s_id"))

time_tools$d2source <- sqrt(((time_tools$x-time_tools$s_x)^2) + ((time_tools$y-time_tools$s_y)^2))

time_dist_sum <- time_tools %>% 
  group_by(run_id) %>%
  summarise(min_d2source = min(d2source),
            mean_d2source = mean(d2source),
            max_d2source = max(d2source))
time_dist_sum <- left_join(time_dist_sum, time_run_data)
```

  Figure \ref{time d2source} shows that the number of time steps in model runs where trees can die and regrow also has a positive effect on the on the distance tools travel from their source. More plainly put, the longer the model runs, the farther tools will travel from there source. However, even when model runs for 3 times as many time steps (compare 25k time steps with 75k time steps), tools only travel on average an additional grid-cell farther (left panel). This result suggests that at these levels of tree density. The distance a tool travels, although influenced by time, is largely dictated by the density of trees within within the model space.
```{r fig.cap= "The effect of number of trees on distance to source values over time. Runs with 100 sources, and 1000 trees shown.  \\label{time d2source}", fig.height= 4, fig.width=6.5}

sub <- subset(time_dist_sum, num_sources == 100 & num_nutree == 1000)

a <- ggplot(sub, aes(x = as.factor(n_time_steps), y = mean_d2source, fill = as.factor(treessdie))) +
  geom_boxplot()+
  theme(legend.position = "top")
b <- ggplot(sub, aes(x = as.factor(n_time_steps), y = max_d2source, fill = as.factor(treessdie))) + 
  geom_boxplot() + 
  theme(legend.position = "top")

grid.arrange(a,b, ncol = 2)
```
  
  
```{r fig.cap= "Plots showing the mean and maximum distance to source according to the number of trees and quality of raw materials. Black box plots show runs where trees can die and regrow \\label{d2sourcerm}", fig.height=4, fig.width=6.5}

time_OGs <- subset(time_tools, Tool_size >= 2000)
time_dist_sum_rm <- time_tools %>% 
  group_by(run_id, rm_quality) %>%
  summarise(min_d2source = min(d2source),
            mean_d2source = mean(d2source),
            max_d2source = max(d2source))
time_dist_sum_rm <- left_join(time_dist_sum_rm, time_run_data)

sub <- time_dist_sum_rm[time_dist_sum_rm$num_sources == 100,]
sub <- sub[sub$num_nutree == 100,]
sub <- sub[sub$treessdie == 0,]

a <- ggplot(sub, aes(x = as.factor(n_time_steps), y = mean_d2source, fill = as.factor(rm_quality))) +
  geom_boxplot() + 
  ggtitle("100 trees") +
  theme(legend.position = "top")

sub <- time_dist_sum_rm[time_dist_sum_rm$num_sources == 100,]
sub <- sub[sub$num_nutree == 500,]
sub <- sub[sub$treessdie == 0,]

b <- ggplot(sub, aes(x = as.factor(n_time_steps), y = mean_d2source, fill = as.factor(rm_quality))) +
  geom_boxplot() + 
  ggtitle("500 trees") + 
  theme(legend.position = "top")

sub <- time_dist_sum_rm[time_dist_sum_rm$num_sources == 100,]
sub <- sub[sub$num_nutree == 1000,]
sub <- sub[sub$treessdie == 0,]

c <- ggplot(sub, aes(x = as.factor(n_time_steps), y = mean_d2source, fill = as.factor(rm_quality))) +
  geom_boxplot() + ggtitle("1000 trees") + theme(legend.position = "top")


sub <- time_dist_sum_rm[time_dist_sum_rm$num_sources == 100,]
sub <- sub[sub$num_nutree == 100,]
sub <- sub[sub$treessdie == 1,]


d <- ggplot(sub, aes(x = as.factor(n_time_steps), y = mean_d2source, fill = as.factor(rm_quality))) +
  geom_boxplot() + 
  ggtitle("100 trees, Trees regrow") +
  theme(legend.position = "top")

sub <- time_dist_sum_rm[time_dist_sum_rm$num_sources == 100,]
sub <- sub[sub$num_nutree == 500,]
sub <- sub[sub$treessdie == 1,]

e <- ggplot(sub, aes(x = as.factor(n_time_steps), y = mean_d2source, fill = as.factor(rm_quality))) +
  geom_boxplot() + 
  ggtitle("500 trees, Trees regrow") + 
  theme(legend.position = "top")

sub <- time_dist_sum_rm[time_dist_sum_rm$num_sources == 100,]
sub <- sub[sub$num_nutree == 1000,]
sub <- sub[sub$treessdie == 1,]

f <- ggplot(sub, aes(x = as.factor(n_time_steps), y = mean_d2source, fill = as.factor(rm_quality))) +
  geom_boxplot() + ggtitle("1000 trees, Trees regrow") + theme(legend.position = "top")

grid.arrange(a,b,c, 
             d,e,f,
             ncol = 3)
```
  
  There seem to be an interacting effect between time, raw material quality, and the number of trees(Figure \ref{d2sourcerm}). When the trees are 100 there is no relationship between distance to raw material source and raw material quality. In addition, neither the number of time-steps nor whether or not trees die and regrow influences this pattern. When the number of trees included in the model is 500, instances where trees remain at fixed locations throughout the run also show no relationship between raw material quality and distance to raw material source. However, in instances where trees die and regrow, runs with 50k and 75, show a relationship between distance to raw material source raw material quality. Raw material quality (0 is best, 75 is worst) has a positive effect on distance traveled from the source. In cases, where the number of trees is 1000, there may be a faint relationship between raw material quality an distance to source when trees remain at fixed locations. However, if there is, it is extremely weak. When trees can die and regrow there is a clear positive relationship between distance to source and raw material quality.
  
  The relationship is less clear than I thought it would be. Maybe this is due to the fact that transport distances are largely dependent on the density of trees and their proximity to sources. If a high quality source does not occur next to a configuration of trees which stones can incrementally moved from tree to tree, then it a high quality material will never travel very far. In contrast if a low quality material is next to a group trees that facilitates this island hopping effect a low quality material could travel farther than a high quality materal. It could be that there are is a tree density threshold in which this pattern becomes more clear. This seems to be the case to some extent since  the pattern only becomes visible when the number of trees is > 500. The death and regrowth of trres plays a critical role in the visibility of this pattern. It is really only clear in instances where trees can die and regrow. I guess this facilitates the continuous use and transport away from source locations (See explaination above). Time doesn't seem to play too much of a role beyond facilitating slightly farther distance to source vaues.
  
```{r fig.cap= "The influence of the number of sources on the mean and max distance to source of tools \\label{d2source_sources}", fig.height=4, fig.width=6.5}

dist_sum <- tools %>% 
  group_by(num_sources, num_nutree, treessdie) %>%
  summarise(min_d2source = min(d2source),
            mean_d2source = mean(d2source),
            max_d2source = max(d2source))

a <- ggplot(dist_sum, aes(x = as.factor(num_sources), y = mean_d2source, fill = as.factor(treessdie))) +
  geom_boxplot()+
  theme(legend.position = "top")
b <- ggplot(dist_sum, aes(x = as.factor(num_sources), y = max_d2source, fill = as.factor(treessdie))) + 
  geom_boxplot() + 
  theme(legend.position = "top")

grid.arrange(a,b, ncol = 2)
```

Not sure what is going on here (Figure \ref{d2source_sources}). I'm also not sure its worth talking about. 
  
### Number of hammers 

The last line of evidence that could support the relationship between the trees and tool use is the number of hammers. Since tools will be constantly moved away from sources, agents may have to acquire new hammers from sources more often. If landscapes are actually being seeded with hammers then this should show it.

```{r, fig.cap= "The influence of the number of sources on the number of hammers in a given model run \\label{n_hammers}", fig.height=4, fig.width=6.5}

OGs_sum <- OGs %>% group_by(run_id) %>%
  summarise(n_hammers = n())
OGs_sum <- left_join(OGs_sum, run_data)

a <- ggplot(OGs_sum[OGs_sum$treessdie == 0,], aes(x = as.factor(num_nutree), 
                    y = n_hammers, fill = as.factor(num_sources))) +
  geom_boxplot()+
  ggtitle("Trees do not die")+
  theme(legend.position = "top")

b <- ggplot(OGs_sum[OGs_sum$treessdie == 1,], aes(x = as.factor(num_nutree), 
                    y = n_hammers, fill = as.factor(num_sources))) +
  geom_boxplot()+
  ggtitle("Trees die")+
  theme(legend.position = "top")

grid.arrange(a,b, ncol = 2)
```

So the figure (figure \ref{n_hammers}), really illustrates the niche construction point. The number of sources have a substantial effect on the number of hammers that get introduced to a given landscape. This makes sense given that this controls the number of places where stone can be acquired. What is cool about this plot though is that is that when holding then number sources constant, the sheer number of trees has an effect on the number of hammers that are introduced to a given landscape. This in my mind really hammers home how the panda tool using niche is constructed, the interaction between tree density, source density, and tool transport, produces a landscape which access to nuts is more accessible.  

# 2.0 The influence the system on archaeological assemblages


### 2.1 Representation of artifact size

  If we are interested in what these time averaged assemblages then the first thing to do would be to test what Tom said about the asssmeblage composition of the artifact assemblages at panda 100.  

```{r}
site_sum <- tools %>%
  group_by(run_id, x, y) %>%
  summarise(min_size = min(Tool_size),
            mean_size = mean(Tool_size),
            max_size = max(Tool_size),
            n_frags = sum(Tool_size < 2000),
            n_tools = sum(Tool_size >= 2000),
            n = n())

site_sum$f2t <- site_sum$n_frags/site_sum$n_tools
site_sum <- left_join(site_sum, run_data, by = c("run_id" = "run_id"))

n_sites_no_tools <- sum(site_sum$n_tools == 0)
per_sites_no_tools <-n_sites_no_tools/nrow(site_sum)
per_sites_1_tool <- sum(site_sum$n_tools == 1)/nrow(site_sum)

```

```{r fig.cap= "Mean size of artifacts according to number of sources (Colors) and trees (x-axis). Y axis is in log scale. Includes both iteractions where trees die and trees do not die \\label{mean_size_source_trees}", fig.height=4, fig.width=6.5}

ggplot(site_sum[site_sum$treessdie == 0,], aes(x = as.factor(num_nutree), y = mean_size, fill = as.factor(num_sources)))+
  geom_boxplot()+ 
  geom_hline(yintercept = 2000)+
  scale_y_continuous(limits = c(0,20000))+
  scale_y_log10()+
  theme(legend.position = "top")

```
  
  Figure \ref{mean_size_source_trees} shows that the vast majority of artifacts are less than 2000g meaning that they would be classified as fragments. The black bar corresponds to the threhold in which pounding tools are considered exhausted. Note that the average size of an artifact within an individual assemblage for nearly every assemblage falls below this line. In fact, `r round(per_sites_no_tools, 2) *100` percent of sites do not possess hammers. An additional `r round(per_sites_1_tool, 2)*100` percent only possess 1 tool. The number of trees seem to have a small influence in the inter-quartile range on the mean size of artifacts. Inter-quartile ranges seem to get smaller as the number of trees increases. The number of sources seems an equally small but opposite effect. The main point of this figure it is it shows a clear dispartity between the tool forms used during the and would be observed by ethologists during a nut-cracking event and what enters the archaeological record. 

### The influence of environmental variables on hammer size

  If our hypothesis that the number of trees and the death and growth of trees facilitates more tool use we should see this also in the number to times hammers are used. If this is correct, the number of uses per tool should be greater in runs with more trees and when trees die.
  
```{r, fig.cap= "The relationship between the number of sources and the number of trees on the number of times tools get used.  \\label{uses_trees_sources}", fig.height=4, fig.width=6.5}

a <- ggplot(OGs[OGs$treessdie == 0,], aes(x = as.factor(num_nutree), y = n_uses, fill =as.factor(num_sources))) +
  geom_boxplot()+
  scale_y_log10()+
  theme(legend.position = "top") + ggtitle("No Death")

b <- ggplot(OGs[OGs$treessdie == 1,], aes(x = as.factor(num_nutree), y = n_uses, fill =as.factor(num_sources))) +
  geom_boxplot()+
  scale_y_log10() + 
  theme(legend.position = "top")+ ggtitle("Trees Die")

grid.arrange(a,b, ncol = 2)
```

Figure \ref{uses_trees_sources} shows that only in specific circumstances does the number of trees influence how used tools are. When the number of sources is low (10, red) increasing the number of trees does seem to influence how often a tool gets used. When the number of trees is 100, there is no difference. However, when the number of trees is 500, we can see that in runs wheren the number of sources is 10 the median remains the same but the inter-quartile range shows a bias to toward more uses. When the number trees is 1000 and the number of sources is 10, both the median and inter-quartile range show a subtle bias towards tools being used more. However, the differences are small and likely not significant. It maybe that in cases where the tree density is extremely high (more than what is tested here) that start to see this effect. This makes sense to me because the number of sources ultimately determines how many hammers can be re-used.

At first it did seem odd to me that there were only marginal differences in how used hammers are but I think given the relationship between the number of tools and source and tree denisty it actually makes sense. It comes down to basic probability. In senarios where there are more trees it is intuitive to think that more opportunities to crack nuts would lead to more intensively used stones. However, the sources can provide an unlimited stones to the landscape. Meaning that when a tool is moved away from the source, there may not be pressure to use that stone more becasue there is always a chance to acquire a new stone from a source. As more new stones enter the landscape the likelihood of a individual stone being selected for use gets smaller (Think the elementary school word problem timmy has 40 jelly beans and one of them is red....). So the pressure to continuously use stones over and over again gets mitigated by the fact that there may always be another stone that is closer. 

  Now there will be places where the pressure to re-use stones. This is particularly in places where sources are far away. We can probably see this effect in the maximum number of uses, or in other measures of tool utilization but it may not have a substantial effect on the mean or average amount of use that tool is subject tool. This can be further backed up by other use proxies such as hammer size and percent mass lost ect. 
  
  
```{r fig.cap= "The size of hammers according to the number of sources and trees.  \\label{hammersize_source_tree}" , fig.height=4, fig.width=6.5}


a <- ggplot(OGs[OGs$treessdie == 0,], aes(x = as.factor(num_nutree), y = Tool_size, fill = as.factor(num_sources)))+
  geom_boxplot()+ 
  geom_hline(yintercept = 2000)+
  ggtitle("Trees Don't Die") + 
  theme(legend.position = "top")

b <- ggplot(OGs[OGs$treessdie == 1,], aes(x = as.factor(num_nutree), y = Tool_size, fill = as.factor(num_sources)))+
  geom_boxplot()+ 
  geom_hline(yintercept = 2000)+
  ggtitle("Trees Don't Die") + 
  theme(legend.position = "top")

grid.arrange(a,b, ncol = 2)
```

Figure \ref{hammersize_source_tree} demonstrates that neither the number of sources nor trees has a significant impact on the size of hammers. This shows that despite the fact that the number of trees reduces that amount of variance in the size of artifact in a given assemblage, it appears as if tools do not get used more or less depending on then number of sources and trees. The distribution of hammer size values also shows that most hammers do not become exhausted over the course of the model run. It also shows the main influence that the number of trees (within what is tested) here does not influence how often the tools are utilized but rather how much they are moved.   

### Tree Death and regrowth
```{r fig.cap= "The size of hammers according to whether or not trees die.  \\label{hammersize_trees_die}", fig.height=4, fig.width=6.5}

ggplot(OGs[OGs$num_sources == 100,], aes(x = as.factor(num_nutree), y = Tool_size, fill = as.factor(treessdie)))+
  geom_boxplot()+ 
  geom_hline(yintercept = 2000)+
  theme(legend.position = "top")
  
```

Figure \ref{hammersize_trees_die} demonstrates that the death and regrowth of trees has little effect on hammer size. Further solidifying the fact that trees and sources do not influence how utilized hammers are but rather their transport.


### Effect of distance to source on tool size

```{r fig.height=8, fig.width=6.5, fig.cap= "The influence of the distance to source on the size of the tools, percent nass lost from tools and the number of uses when there are 100 sources and 1000 trees \\label{d2source_utilization}"}


OGs$mass_lost <- OGs$original_size - OGs$Tool_size
OGs$per_mass_lost <- OGs$mass_lost/OGs$original_size

a <- ggplot(OGs[OGs$num_sources == 100 & OGs$num_nutree == 1000 & OGs$treessdie == 1,], aes(x = d2source, y = as.numeric(n_uses), color = as.factor(rm_quality)))+ 
  geom_point() 
  

b <- ggplot(OGs[OGs$num_sources == 100 & OGs$num_nutree == 1000 & OGs$treessdie == 1,], aes(x = d2source, y = Tool_size, color = ts_born))+
  geom_point()

c <- ggplot(OGs[OGs$num_sources == 100 & OGs$num_nutree == 1000 & OGs$treessdie == 1,], aes(x = d2source, y = per_mass_lost, color = as.factor(rm_quality)))+
  geom_point()
  
grid.arrange(a,b,c, ncol=1)

```


This is futher substantiated by the fact that hammer size is noisly correlated with transport. Hammers that are farther from their sources are more often smaller than those closer. However, it is still possible to get small hammers closer to the source. This result (Figure \ref{d2source_utilization}) is a little counter intuitive. I would have expected there to be a stronger relationship with the number of uses and distance to source. I guess that it is completely influenced by the spatial distribution of trees. If there are enough trees clustered together then the number of uses might be more reflected in distance to source but if there are no trees to island hop between then it will continue to be used at one tree and never get farther from the source. 


### Raw Material Quality

```{r fig.cap= "The proportion of mass lost from hammers according to raw material quality.  \\label{hammersize_rm_quality}", fig.height=4, fig.width=6.5}
  
ggplot(OGs, aes(x = as.factor(num_nutree), y = per_mass_lost, color = as.factor(num_sources), fill = as.factor(rm_quality)))+
  geom_boxplot()+
  theme(legend.position = "top")
  
```

Figure \ref{hammersize_rm_quality} demonstrates that raw material quality have a small effect on how utilized stone is. High quality hammers (0) have less mass removed due to fracture than those that are less quality. It is also easier to see here that the number of trees does have an effect on how used the tools are. However its a pretty small effect, it would be good to see how this pattern plays out with a huge amount of trees.

### Fragment to tool ratio   

This is is really interesting because it shows the increased transport of tools influences the composition of the archaeological pattern. 

```{r}

ggplot(site_sum, aes(x = as.factor(num_nutree), y = f2t, fill = as.factor(treessdie))) + geom_boxplot()

```

The ratio of flake to tool is less when trees dies because the death and regrowth process is facilitates the movement of stone. Therefore tools and artifacts get spread out over more space. Whereas when trees are fixed and immortal more time is spent making cracking nuts at a specific set of locations. 

```{r}
ggplot(site_sum, aes(x = as.factor(num_nutree), y = n, fill = as.factor(treessdie))) + geom_boxplot()
```

This is supported by the fact that on average the number artifacts in assemblages from runs where trees die is less than in those where trees do not die. Increased transport spreads artifacts out more. 

### Where are the sites with large numbers of hammers?

```{r, fig.cap= "The relationship between the number of hammers and distance to source \\label{n_d2source}"}
OGs_sum <- OGs %>% group_by(run_id, x, y) %>%
  summarise(n_hammers = n(),
            min_d2_source = min(d2source),
            med_d2_source = median(d2source),
            max_d2_source = max(d2source))

ggplot(OGs_sum, aes(x = min_d2_source, y = n_hammers)) + geom_point()
```

Figure \ref{n_d2source} clearly shows that the number of hammers within an assemblage is correlated with distance to source. So if you want to find places where there are lots of hammers look close to sources.